[
  {
    "full_dump": "{\n    \"views\": [\n    ],\n    \"tables\": [\n        \"admin_pins\",\n        \"app_settings\",\n        \"notice_ack\",\n        \"notice_targets\",\n        \"notices\",\n        \"notifications\",\n        \"pattern_definitions\",\n        \"permission_group_permissions\",\n        \"permission_groups\",\n        \"permissions\",\n        \"planned_assignments\",\n        \"request_cell_locks\",\n        \"requests\",\n        \"roles\",\n        \"rota_assignment_audits\",\n        \"rota_assignment_comments\",\n        \"rota_assignment_overrides\",\n        \"rota_assignments\",\n        \"rota_dates\",\n        \"rota_periods\",\n        \"rota_weeks\",\n        \"sessions\",\n        \"shift_catalogue\",\n        \"shift_eligibility\",\n        \"shifts\",\n        \"staffing_requirements\",\n        \"swap_executions\",\n        \"swap_requests\",\n        \"user_patterns\",\n        \"user_permission_groups\",\n        \"users\",\n        \"week_comments\"\n    ],\n    \"columns\": [\n        {\n            \"type\": \"uuid\",\n            \"table\": \"admin_pins\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"admin_pins\",\n            \"column\": \"pin\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"admin_pins\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"app_settings\",\n            \"column\": \"key\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"app_settings\",\n            \"column\": \"value\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notice_ack\",\n            \"column\": \"notice_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notice_ack\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"notice_ack\",\n            \"column\": \"acknowledged_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"notice_ack\",\n            \"column\": \"version\",\n            \"default\": \"1\",\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notice_targets\",\n            \"column\": \"notice_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"notice_targets\",\n            \"column\": \"role_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notices\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"notices\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"notices\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notices\",\n            \"column\": \"created_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notices\",\n            \"column\": \"title\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notices\",\n            \"column\": \"body_en\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notices\",\n            \"column\": \"body_es\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"notices\",\n            \"column\": \"target_role_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 8,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"notices\",\n            \"column\": \"is_active\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"notices\",\n            \"column\": \"target_all\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 10,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"ARRAY\",\n            \"table\": \"notices\",\n            \"column\": \"target_roles\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 11,\n            \"udt_name\": \"_int4\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notices\",\n            \"column\": \"role\",\n            \"default\": \"'all'::text\",\n            \"nullable\": \"YES\",\n            \"position\": 12,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"notices\",\n            \"column\": \"version\",\n            \"default\": \"1\",\n            \"nullable\": \"YES\",\n            \"position\": 13,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notifications\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notifications\",\n            \"column\": \"type\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"jsonb\",\n            \"table\": \"notifications\",\n            \"column\": \"payload\",\n            \"default\": \"'{}'::jsonb\",\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"jsonb\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notifications\",\n            \"column\": \"target_scope\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"ARRAY\",\n            \"table\": \"notifications\",\n            \"column\": \"target_role_ids\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"_int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notifications\",\n            \"column\": \"target_user_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"notifications\",\n            \"column\": \"requires_action\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 7,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"notifications\",\n            \"column\": \"status\",\n            \"default\": \"'pending'::text\",\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notifications\",\n            \"column\": \"created_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 9,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"notifications\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 10,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notifications\",\n            \"column\": \"updated_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 11,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"notifications\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 12,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"notifications\",\n            \"column\": \"acted_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 13,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"notifications\",\n            \"column\": \"acted_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 14,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"cycle_weeks\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"ARRAY\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"weekly_targets\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"_int4\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"pattern_type\",\n            \"default\": \"'repeating'::text\",\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"requires_anchor\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"anchor_type\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"notes\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 8,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"is_active\",\n            \"default\": \"true\",\n            \"nullable\": \"YES\",\n            \"position\": 9,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 11,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"group_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"permission_key\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"permission_groups\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"permission_groups\",\n            \"column\": \"name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"permission_groups\",\n            \"column\": \"is_system\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"permission_groups\",\n            \"column\": \"is_protected\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"permission_groups\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"permissions\",\n            \"column\": \"key\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"permissions\",\n            \"column\": \"label\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"permissions\",\n            \"column\": \"description\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"permissions\",\n            \"column\": \"category\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"week_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"reason_en\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"reason_es\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"locked_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"locked_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 7,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"requests\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"requests\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"requests\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"requests\",\n            \"column\": \"value\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"requests\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"smallint\",\n            \"table\": \"requests\",\n            \"column\": \"important_rank\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"int2\"\n        },\n        {\n            \"type\": \"smallint\",\n            \"table\": \"roles\",\n            \"column\": \"id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int2\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"roles\",\n            \"column\": \"name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"id\",\n            \"default\": \"nextval('rota_assignment_audits_id_seq'::regclass)\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"old_shift_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"new_shift_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"action_type\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 7,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"changed_by\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"changed_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"comment\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"id\",\n            \"default\": \"nextval('rota_assignment_comments_id_seq'::regclass)\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"rota_assignment_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"comment\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"is_admin_only\",\n            \"default\": \"false\",\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"created_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"updated_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 8,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"comment_visibility\",\n            \"default\": \"'all_staff'::text\",\n            \"nullable\": \"YES\",\n            \"position\": 9,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"id\",\n            \"default\": \"nextval('rota_assignment_overrides_id_seq'::regclass)\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"rota_assignment_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"time without time zone\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"override_start_time\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"time\"\n        },\n        {\n            \"type\": \"time without time zone\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"override_end_time\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"time\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"override_hours\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"comment\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"created_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 8,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"updated_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 9,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"comment_visible_to_user\",\n            \"default\": \"false\",\n            \"nullable\": \"YES\",\n            \"position\": 11,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"comment_visibility\",\n            \"default\": \"'admin_only'::text\",\n            \"nullable\": \"YES\",\n            \"position\": 12,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"id\",\n            \"default\": \"nextval('rota_assignments_id_seq'::regclass)\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"shift_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"status\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_dates\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_dates\",\n            \"column\": \"week_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_dates\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_periods\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_periods\",\n            \"column\": \"name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_periods\",\n            \"column\": \"start_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_periods\",\n            \"column\": \"end_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_periods\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"rota_periods\",\n            \"column\": \"is_active\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_periods\",\n            \"column\": \"request_open_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_periods\",\n            \"column\": \"request_close_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 8,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"rota_periods\",\n            \"column\": \"is_hidden\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_periods\",\n            \"column\": \"closes_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"rota_periods\",\n            \"column\": \"status\",\n            \"default\": \"'draft'::text\",\n            \"nullable\": \"NO\",\n            \"position\": 11,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"rota_periods\",\n            \"column\": \"published_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 12,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_periods\",\n            \"column\": \"published_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 13,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"rota_periods\",\n            \"column\": \"published_version\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 14,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"week_start\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"week_end\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"open\",\n            \"default\": \"true\",\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"open_after_close\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"sessions\",\n            \"column\": \"token\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"sessions\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"sessions\",\n            \"column\": \"expires_at\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"sessions\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"id\",\n            \"default\": \"nextval('shift_catalogue_id_seq'::regclass)\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"label\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"time without time zone\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"start_time\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"time\"\n        },\n        {\n            \"type\": \"time without time zone\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"end_time\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"time\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"hours_value\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"is_night\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 7,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"allow_requests\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"allow_draft\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"allow_post_publish\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 10,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"is_active\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 11,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 12,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"shift_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"staff_grade\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"shifts\",\n            \"column\": \"id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shifts\",\n            \"column\": \"code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shifts\",\n            \"column\": \"label\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"time without time zone\",\n            \"table\": \"shifts\",\n            \"column\": \"start_time\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"time\"\n        },\n        {\n            \"type\": \"time without time zone\",\n            \"table\": \"shifts\",\n            \"column\": \"end_time\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"time\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"shifts\",\n            \"column\": \"hours_value\",\n            \"default\": \"0\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shifts\",\n            \"column\": \"day_or_night\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shifts\",\n            \"column\": \"allowed_staff_groups\",\n            \"default\": \"'NA,Nurse'::text\",\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shifts\",\n            \"column\": \"allow_requests\",\n            \"default\": \"true\",\n            \"nullable\": \"YES\",\n            \"position\": 9,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shifts\",\n            \"column\": \"allow_draft\",\n            \"default\": \"true\",\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shifts\",\n            \"column\": \"allow_post_publish\",\n            \"default\": \"true\",\n            \"nullable\": \"YES\",\n            \"position\": 11,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"shifts\",\n            \"column\": \"created_at\",\n            \"default\": \"CURRENT_TIMESTAMP\",\n            \"nullable\": \"YES\",\n            \"position\": 12,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shifts\",\n            \"column\": \"fill_color\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 13,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"shifts\",\n            \"column\": \"text_color\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 14,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shifts\",\n            \"column\": \"text_bold\",\n            \"default\": \"false\",\n            \"nullable\": \"YES\",\n            \"position\": 15,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"shifts\",\n            \"column\": \"text_italic\",\n            \"default\": \"false\",\n            \"nullable\": \"YES\",\n            \"position\": 16,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"bigint\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"id\",\n            \"default\": \"nextval('staffing_requirements_id_seq'::regclass)\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"int8\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"day_sn_required\",\n            \"default\": \"3.0\",\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"day_na_required\",\n            \"default\": \"3.0\",\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"night_sn_required\",\n            \"default\": \"2.0\",\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"numeric\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"night_na_required\",\n            \"default\": \"2.0\",\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"numeric\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 8,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 9,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_executions\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_executions\",\n            \"column\": \"swap_request_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"method\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"swap_executions\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_week_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_week_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 7,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 10,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_executions\",\n            \"column\": \"authoriser_user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 11,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"authoriser_name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 12,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_old_shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 13,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_old_shift_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 14,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_new_shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 15,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"swap_executions\",\n            \"column\": \"initiator_new_shift_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 16,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_old_shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 17,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_old_shift_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 18,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_new_shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 19,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"swap_executions\",\n            \"column\": \"counterparty_new_shift_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 20,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"swap_executions\",\n            \"column\": \"executed_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 21,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"swap_executions\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 22,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_requests\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"swap_requests\",\n            \"column\": \"period_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_requests\",\n            \"column\": \"initiator_user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"swap_requests\",\n            \"column\": \"initiator_shift_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_requests\",\n            \"column\": \"initiator_shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"swap_requests\",\n            \"column\": \"initiator_week_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 7,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_shift_date\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_shift_code\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_week_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_requests\",\n            \"column\": \"status\",\n            \"default\": \"'pending'::text\",\n            \"nullable\": \"NO\",\n            \"position\": 11,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_response\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 12,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_responded_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 13,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"swap_requests\",\n            \"column\": \"admin_decision\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 14,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"swap_requests\",\n            \"column\": \"admin_user_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 15,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"swap_requests\",\n            \"column\": \"admin_decided_at\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 16,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"swap_requests\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 17,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"swap_requests\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 18,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"user_patterns\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"user_patterns\",\n            \"column\": \"pattern_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"date\",\n            \"table\": \"user_patterns\",\n            \"column\": \"anchor_week_start_date\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"date\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"user_patterns\",\n            \"column\": \"assigned_by\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"user_patterns\",\n            \"column\": \"assigned_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"timestamp without time zone\",\n            \"table\": \"user_patterns\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 6,\n            \"udt_name\": \"timestamp\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"group_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"users\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"users\",\n            \"column\": \"name\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"users\",\n            \"column\": \"pin_hash\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 3,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"users\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"YES\",\n            \"position\": 4,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"smallint\",\n            \"table\": \"users\",\n            \"column\": \"role_id\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 5,\n            \"udt_name\": \"int2\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"users\",\n            \"column\": \"can_edit\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"users\",\n            \"column\": \"is_admin\",\n            \"default\": \"false\",\n            \"nullable\": \"NO\",\n            \"position\": 7,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"boolean\",\n            \"table\": \"users\",\n            \"column\": \"is_active\",\n            \"default\": \"true\",\n            \"nullable\": \"NO\",\n            \"position\": 8,\n            \"udt_name\": \"bool\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"users\",\n            \"column\": \"preferred_lang\",\n            \"default\": \"'en'::text\",\n            \"nullable\": \"NO\",\n            \"position\": 9,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"integer\",\n            \"table\": \"users\",\n            \"column\": \"display_order\",\n            \"default\": null,\n            \"nullable\": \"YES\",\n            \"position\": 10,\n            \"udt_name\": \"int4\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"week_comments\",\n            \"column\": \"id\",\n            \"default\": \"gen_random_uuid()\",\n            \"nullable\": \"NO\",\n            \"position\": 1,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"week_comments\",\n            \"column\": \"week_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 2,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"uuid\",\n            \"table\": \"week_comments\",\n            \"column\": \"user_id\",\n            \"default\": null,\n            \"nullable\": \"NO\",\n            \"position\": 3,\n            \"udt_name\": \"uuid\"\n        },\n        {\n            \"type\": \"text\",\n            \"table\": \"week_comments\",\n            \"column\": \"comment\",\n            \"default\": \"''::text\",\n            \"nullable\": \"NO\",\n            \"position\": 4,\n            \"udt_name\": \"text\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"week_comments\",\n            \"column\": \"updated_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 5,\n            \"udt_name\": \"timestamptz\"\n        },\n        {\n            \"type\": \"timestamp with time zone\",\n            \"table\": \"week_comments\",\n            \"column\": \"created_at\",\n            \"default\": \"now()\",\n            \"nullable\": \"NO\",\n            \"position\": 6,\n            \"udt_name\": \"timestamptz\"\n        }\n    ],\n    \"indexes\": [\n        {\n            \"name\": \"admin_pins_pkey\",\n            \"table\": \"admin_pins\",\n            \"definition\": \"CREATE UNIQUE INDEX admin_pins_pkey ON public.admin_pins USING btree (user_id)\"\n        },\n        {\n            \"name\": \"app_settings_pkey\",\n            \"table\": \"app_settings\",\n            \"definition\": \"CREATE UNIQUE INDEX app_settings_pkey ON public.app_settings USING btree (key)\"\n        },\n        {\n            \"name\": \"notice_ack_notice_idx\",\n            \"table\": \"notice_ack\",\n            \"definition\": \"CREATE INDEX notice_ack_notice_idx ON public.notice_ack USING btree (notice_id)\"\n        },\n        {\n            \"name\": \"notice_ack_pkey\",\n            \"table\": \"notice_ack\",\n            \"definition\": \"CREATE UNIQUE INDEX notice_ack_pkey ON public.notice_ack USING btree (notice_id, user_id)\"\n        },\n        {\n            \"name\": \"notice_ack_user_idx\",\n            \"table\": \"notice_ack\",\n            \"definition\": \"CREATE INDEX notice_ack_user_idx ON public.notice_ack USING btree (user_id, acknowledged_at DESC)\"\n        },\n        {\n            \"name\": \"notice_targets_pkey\",\n            \"table\": \"notice_targets\",\n            \"definition\": \"CREATE UNIQUE INDEX notice_targets_pkey ON public.notice_targets USING btree (notice_id, role_id)\"\n        },\n        {\n            \"name\": \"notices_active_idx\",\n            \"table\": \"notices\",\n            \"definition\": \"CREATE INDEX notices_active_idx ON public.notices USING btree (is_active, created_at DESC)\"\n        },\n        {\n            \"name\": \"notices_pkey\",\n            \"table\": \"notices\",\n            \"definition\": \"CREATE UNIQUE INDEX notices_pkey ON public.notices USING btree (id)\"\n        },\n        {\n            \"name\": \"notices_target_role_idx\",\n            \"table\": \"notices\",\n            \"definition\": \"CREATE INDEX notices_target_role_idx ON public.notices USING btree (target_role_id)\"\n        },\n        {\n            \"name\": \"notifications_pending_idx\",\n            \"table\": \"notifications\",\n            \"definition\": \"CREATE INDEX notifications_pending_idx ON public.notifications USING btree (status) WHERE (status = 'pending'::text)\"\n        },\n        {\n            \"name\": \"notifications_pkey\",\n            \"table\": \"notifications\",\n            \"definition\": \"CREATE UNIQUE INDEX notifications_pkey ON public.notifications USING btree (id)\"\n        },\n        {\n            \"name\": \"notifications_target_role_idx\",\n            \"table\": \"notifications\",\n            \"definition\": \"CREATE INDEX notifications_target_role_idx ON public.notifications USING gin (target_role_ids) WHERE (target_scope = 'role'::text)\"\n        },\n        {\n            \"name\": \"notifications_target_user_idx\",\n            \"table\": \"notifications\",\n            \"definition\": \"CREATE INDEX notifications_target_user_idx ON public.notifications USING btree (target_user_id) WHERE (target_scope = 'user'::text)\"\n        },\n        {\n            \"name\": \"pattern_definitions_name_key\",\n            \"table\": \"pattern_definitions\",\n            \"definition\": \"CREATE UNIQUE INDEX pattern_definitions_name_key ON public.pattern_definitions USING btree (name)\"\n        },\n        {\n            \"name\": \"pattern_definitions_pkey\",\n            \"table\": \"pattern_definitions\",\n            \"definition\": \"CREATE UNIQUE INDEX pattern_definitions_pkey ON public.pattern_definitions USING btree (id)\"\n        },\n        {\n            \"name\": \"permission_group_permissions_pkey\",\n            \"table\": \"permission_group_permissions\",\n            \"definition\": \"CREATE UNIQUE INDEX permission_group_permissions_pkey ON public.permission_group_permissions USING btree (group_id, permission_key)\"\n        },\n        {\n            \"name\": \"permission_groups_name_key\",\n            \"table\": \"permission_groups\",\n            \"definition\": \"CREATE UNIQUE INDEX permission_groups_name_key ON public.permission_groups USING btree (name)\"\n        },\n        {\n            \"name\": \"permission_groups_pkey\",\n            \"table\": \"permission_groups\",\n            \"definition\": \"CREATE UNIQUE INDEX permission_groups_pkey ON public.permission_groups USING btree (id)\"\n        },\n        {\n            \"name\": \"permissions_pkey\",\n            \"table\": \"permissions\",\n            \"definition\": \"CREATE UNIQUE INDEX permissions_pkey ON public.permissions USING btree (key)\"\n        },\n        {\n            \"name\": \"planned_assignments_pkey\",\n            \"table\": \"planned_assignments\",\n            \"definition\": \"CREATE UNIQUE INDEX planned_assignments_pkey ON public.planned_assignments USING btree (id)\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"table\": \"planned_assignments\",\n            \"definition\": \"CREATE UNIQUE INDEX planned_assignments_user_id_period_id_date_key ON public.planned_assignments USING btree (user_id, period_id, date)\"\n        },\n        {\n            \"name\": \"request_cell_locks_pkey\",\n            \"table\": \"request_cell_locks\",\n            \"definition\": \"CREATE UNIQUE INDEX request_cell_locks_pkey ON public.request_cell_locks USING btree (user_id, date)\"\n        },\n        {\n            \"name\": \"idx_requests_user_date\",\n            \"table\": \"requests\",\n            \"definition\": \"CREATE INDEX idx_requests_user_date ON public.requests USING btree (user_id, date)\"\n        },\n        {\n            \"name\": \"requests_pkey\",\n            \"table\": \"requests\",\n            \"definition\": \"CREATE UNIQUE INDEX requests_pkey ON public.requests USING btree (id)\"\n        },\n        {\n            \"name\": \"requests_user_date_uniq\",\n            \"table\": \"requests\",\n            \"definition\": \"CREATE UNIQUE INDEX requests_user_date_uniq ON public.requests USING btree (user_id, date)\"\n        },\n        {\n            \"name\": \"requests_user_date_unique\",\n            \"table\": \"requests\",\n            \"definition\": \"CREATE UNIQUE INDEX requests_user_date_unique ON public.requests USING btree (user_id, date)\"\n        },\n        {\n            \"name\": \"requests_user_id_date_key\",\n            \"table\": \"requests\",\n            \"definition\": \"CREATE UNIQUE INDEX requests_user_id_date_key ON public.requests USING btree (user_id, date)\"\n        },\n        {\n            \"name\": \"roles_name_key\",\n            \"table\": \"roles\",\n            \"definition\": \"CREATE UNIQUE INDEX roles_name_key ON public.roles USING btree (name)\"\n        },\n        {\n            \"name\": \"roles_pkey\",\n            \"table\": \"roles\",\n            \"definition\": \"CREATE UNIQUE INDEX roles_pkey ON public.roles USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_rota_assignment_audits_actor_time\",\n            \"table\": \"rota_assignment_audits\",\n            \"definition\": \"CREATE INDEX idx_rota_assignment_audits_actor_time ON public.rota_assignment_audits USING btree (changed_by, changed_at DESC)\"\n        },\n        {\n            \"name\": \"idx_rota_assignment_audits_period_user_date\",\n            \"table\": \"rota_assignment_audits\",\n            \"definition\": \"CREATE INDEX idx_rota_assignment_audits_period_user_date ON public.rota_assignment_audits USING btree (period_id, user_id, date)\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_pkey\",\n            \"table\": \"rota_assignment_audits\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_assignment_audits_pkey ON public.rota_assignment_audits USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_comments_assignment\",\n            \"table\": \"rota_assignment_comments\",\n            \"definition\": \"CREATE INDEX idx_comments_assignment ON public.rota_assignment_comments USING btree (rota_assignment_id)\"\n        },\n        {\n            \"name\": \"idx_comments_user\",\n            \"table\": \"rota_assignment_comments\",\n            \"definition\": \"CREATE INDEX idx_comments_user ON public.rota_assignment_comments USING btree (created_by)\"\n        },\n        {\n            \"name\": \"rota_assignment_comments_pkey\",\n            \"table\": \"rota_assignment_comments\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_assignment_comments_pkey ON public.rota_assignment_comments USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_overrides_assignment\",\n            \"table\": \"rota_assignment_overrides\",\n            \"definition\": \"CREATE INDEX idx_overrides_assignment ON public.rota_assignment_overrides USING btree (rota_assignment_id)\"\n        },\n        {\n            \"name\": \"rota_assignment_overrides_pkey\",\n            \"table\": \"rota_assignment_overrides\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_assignment_overrides_pkey ON public.rota_assignment_overrides USING btree (id)\"\n        },\n        {\n            \"name\": \"rota_assignment_overrides_rota_assignment_id_key\",\n            \"table\": \"rota_assignment_overrides\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_assignment_overrides_rota_assignment_id_key ON public.rota_assignment_overrides USING btree (rota_assignment_id)\"\n        },\n        {\n            \"name\": \"idx_rota_assignments_status\",\n            \"table\": \"rota_assignments\",\n            \"definition\": \"CREATE INDEX idx_rota_assignments_status ON public.rota_assignments USING btree (status)\"\n        },\n        {\n            \"name\": \"rota_assignments_pkey\",\n            \"table\": \"rota_assignments\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_assignments_pkey ON public.rota_assignments USING btree (id)\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"table\": \"rota_assignments\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_assignments_user_id_date_status_key ON public.rota_assignments USING btree (user_id, date, status)\"\n        },\n        {\n            \"name\": \"rota_dates_pkey\",\n            \"table\": \"rota_dates\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_dates_pkey ON public.rota_dates USING btree (date)\"\n        },\n        {\n            \"name\": \"idx_rota_periods_active\",\n            \"table\": \"rota_periods\",\n            \"definition\": \"CREATE INDEX idx_rota_periods_active ON public.rota_periods USING btree (is_active)\"\n        },\n        {\n            \"name\": \"idx_rota_periods_hidden\",\n            \"table\": \"rota_periods\",\n            \"definition\": \"CREATE INDEX idx_rota_periods_hidden ON public.rota_periods USING btree (is_hidden)\"\n        },\n        {\n            \"name\": \"one_active_rota_period\",\n            \"table\": \"rota_periods\",\n            \"definition\": \"CREATE UNIQUE INDEX one_active_rota_period ON public.rota_periods USING btree (is_active) WHERE (is_active = true)\"\n        },\n        {\n            \"name\": \"rota_periods_pkey\",\n            \"table\": \"rota_periods\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_periods_pkey ON public.rota_periods USING btree (id)\"\n        },\n        {\n            \"name\": \"rota_weeks_pkey\",\n            \"table\": \"rota_weeks\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_weeks_pkey ON public.rota_weeks USING btree (id)\"\n        },\n        {\n            \"name\": \"rota_weeks_unique_period_week\",\n            \"table\": \"rota_weeks\",\n            \"definition\": \"CREATE UNIQUE INDEX rota_weeks_unique_period_week ON public.rota_weeks USING btree (period_id, week_start)\"\n        },\n        {\n            \"name\": \"sessions_expires_idx\",\n            \"table\": \"sessions\",\n            \"definition\": \"CREATE INDEX sessions_expires_idx ON public.sessions USING btree (expires_at)\"\n        },\n        {\n            \"name\": \"sessions_pkey\",\n            \"table\": \"sessions\",\n            \"definition\": \"CREATE UNIQUE INDEX sessions_pkey ON public.sessions USING btree (token)\"\n        },\n        {\n            \"name\": \"sessions_user_id_idx\",\n            \"table\": \"sessions\",\n            \"definition\": \"CREATE INDEX sessions_user_id_idx ON public.sessions USING btree (user_id)\"\n        },\n        {\n            \"name\": \"idx_shift_catalogue_active\",\n            \"table\": \"shift_catalogue\",\n            \"definition\": \"CREATE INDEX idx_shift_catalogue_active ON public.shift_catalogue USING btree (is_active)\"\n        },\n        {\n            \"name\": \"shift_catalogue_pkey\",\n            \"table\": \"shift_catalogue\",\n            \"definition\": \"CREATE UNIQUE INDEX shift_catalogue_pkey ON public.shift_catalogue USING btree (id)\"\n        },\n        {\n            \"name\": \"shift_eligibility_pkey\",\n            \"table\": \"shift_eligibility\",\n            \"definition\": \"CREATE UNIQUE INDEX shift_eligibility_pkey ON public.shift_eligibility USING btree (id)\"\n        },\n        {\n            \"name\": \"shift_eligibility_shift_id_staff_grade_key\",\n            \"table\": \"shift_eligibility\",\n            \"definition\": \"CREATE UNIQUE INDEX shift_eligibility_shift_id_staff_grade_key ON public.shift_eligibility USING btree (shift_id, staff_grade)\"\n        },\n        {\n            \"name\": \"idx_shifts_allowed_groups\",\n            \"table\": \"shifts\",\n            \"definition\": \"CREATE INDEX idx_shifts_allowed_groups ON public.shifts USING btree (allowed_staff_groups)\"\n        },\n        {\n            \"name\": \"idx_shifts_code\",\n            \"table\": \"shifts\",\n            \"definition\": \"CREATE INDEX idx_shifts_code ON public.shifts USING btree (code)\"\n        },\n        {\n            \"name\": \"idx_shifts_requests\",\n            \"table\": \"shifts\",\n            \"definition\": \"CREATE INDEX idx_shifts_requests ON public.shifts USING btree (allow_requests) WHERE (allow_requests = true)\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"table\": \"shifts\",\n            \"definition\": \"CREATE UNIQUE INDEX shifts_code_hours_allowed_groups_unique ON public.shifts USING btree (code, hours_value, allowed_staff_groups)\"\n        },\n        {\n            \"name\": \"shifts_pkey\",\n            \"table\": \"shifts\",\n            \"definition\": \"CREATE UNIQUE INDEX shifts_pkey ON public.shifts USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_staffing_requirements_period_date\",\n            \"table\": \"staffing_requirements\",\n            \"definition\": \"CREATE INDEX idx_staffing_requirements_period_date ON public.staffing_requirements USING btree (period_id, date)\"\n        },\n        {\n            \"name\": \"staffing_requirements_period_id_date_key\",\n            \"table\": \"staffing_requirements\",\n            \"definition\": \"CREATE UNIQUE INDEX staffing_requirements_period_id_date_key ON public.staffing_requirements USING btree (period_id, date)\"\n        },\n        {\n            \"name\": \"staffing_requirements_pkey\",\n            \"table\": \"staffing_requirements\",\n            \"definition\": \"CREATE UNIQUE INDEX staffing_requirements_pkey ON public.staffing_requirements USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_swap_executions_authoriser\",\n            \"table\": \"swap_executions\",\n            \"definition\": \"CREATE INDEX idx_swap_executions_authoriser ON public.swap_executions USING btree (authoriser_user_id)\"\n        },\n        {\n            \"name\": \"idx_swap_executions_counterparty\",\n            \"table\": \"swap_executions\",\n            \"definition\": \"CREATE INDEX idx_swap_executions_counterparty ON public.swap_executions USING btree (counterparty_user_id)\"\n        },\n        {\n            \"name\": \"idx_swap_executions_initiator\",\n            \"table\": \"swap_executions\",\n            \"definition\": \"CREATE INDEX idx_swap_executions_initiator ON public.swap_executions USING btree (initiator_user_id)\"\n        },\n        {\n            \"name\": \"idx_swap_executions_period\",\n            \"table\": \"swap_executions\",\n            \"definition\": \"CREATE INDEX idx_swap_executions_period ON public.swap_executions USING btree (period_id)\"\n        },\n        {\n            \"name\": \"idx_swap_executions_swap_request\",\n            \"table\": \"swap_executions\",\n            \"definition\": \"CREATE INDEX idx_swap_executions_swap_request ON public.swap_executions USING btree (swap_request_id)\"\n        },\n        {\n            \"name\": \"swap_executions_pkey\",\n            \"table\": \"swap_executions\",\n            \"definition\": \"CREATE UNIQUE INDEX swap_executions_pkey ON public.swap_executions USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_swap_requests_counterparty\",\n            \"table\": \"swap_requests\",\n            \"definition\": \"CREATE INDEX idx_swap_requests_counterparty ON public.swap_requests USING btree (counterparty_user_id)\"\n        },\n        {\n            \"name\": \"idx_swap_requests_initiator\",\n            \"table\": \"swap_requests\",\n            \"definition\": \"CREATE INDEX idx_swap_requests_initiator ON public.swap_requests USING btree (initiator_user_id)\"\n        },\n        {\n            \"name\": \"idx_swap_requests_period\",\n            \"table\": \"swap_requests\",\n            \"definition\": \"CREATE INDEX idx_swap_requests_period ON public.swap_requests USING btree (period_id)\"\n        },\n        {\n            \"name\": \"idx_swap_requests_status\",\n            \"table\": \"swap_requests\",\n            \"definition\": \"CREATE INDEX idx_swap_requests_status ON public.swap_requests USING btree (status)\"\n        },\n        {\n            \"name\": \"swap_requests_pkey\",\n            \"table\": \"swap_requests\",\n            \"definition\": \"CREATE UNIQUE INDEX swap_requests_pkey ON public.swap_requests USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_user_patterns_pattern_id\",\n            \"table\": \"user_patterns\",\n            \"definition\": \"CREATE INDEX idx_user_patterns_pattern_id ON public.user_patterns USING btree (pattern_id)\"\n        },\n        {\n            \"name\": \"user_patterns_pkey\",\n            \"table\": \"user_patterns\",\n            \"definition\": \"CREATE UNIQUE INDEX user_patterns_pkey ON public.user_patterns USING btree (user_id)\"\n        },\n        {\n            \"name\": \"user_permission_groups_pkey\",\n            \"table\": \"user_permission_groups\",\n            \"definition\": \"CREATE UNIQUE INDEX user_permission_groups_pkey ON public.user_permission_groups USING btree (user_id, group_id)\"\n        },\n        {\n            \"name\": \"users_name_key\",\n            \"table\": \"users\",\n            \"definition\": \"CREATE UNIQUE INDEX users_name_key ON public.users USING btree (name)\"\n        },\n        {\n            \"name\": \"users_pkey\",\n            \"table\": \"users\",\n            \"definition\": \"CREATE UNIQUE INDEX users_pkey ON public.users USING btree (id)\"\n        },\n        {\n            \"name\": \"idx_week_comments_user\",\n            \"table\": \"week_comments\",\n            \"definition\": \"CREATE INDEX idx_week_comments_user ON public.week_comments USING btree (user_id)\"\n        },\n        {\n            \"name\": \"idx_week_comments_week\",\n            \"table\": \"week_comments\",\n            \"definition\": \"CREATE INDEX idx_week_comments_week ON public.week_comments USING btree (week_id)\"\n        },\n        {\n            \"name\": \"week_comments_pkey\",\n            \"table\": \"week_comments\",\n            \"definition\": \"CREATE UNIQUE INDEX week_comments_pkey ON public.week_comments USING btree (id)\"\n        },\n        {\n            \"name\": \"week_comments_week_id_user_id_key\",\n            \"table\": \"week_comments\",\n            \"definition\": \"CREATE UNIQUE INDEX week_comments_week_id_user_id_key ON public.week_comments USING btree (week_id, user_id)\"\n        },\n        {\n            \"name\": \"week_comments_week_user_unique\",\n            \"table\": \"week_comments\",\n            \"definition\": \"CREATE UNIQUE INDEX week_comments_week_user_unique ON public.week_comments USING btree (week_id, user_id)\"\n        }\n    ],\n    \"triggers\": [\n        {\n            \"table\": \"notices\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_notices_touch\",\n            \"definition\": \"CREATE TRIGGER trg_notices_touch BEFORE UPDATE ON notices FOR EACH ROW EXECUTE FUNCTION touch_updated_at()\"\n        },\n        {\n            \"table\": \"notices\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_touch_notice\",\n            \"definition\": \"CREATE TRIGGER trg_touch_notice BEFORE UPDATE ON notices FOR EACH ROW EXECUTE FUNCTION touch_notice_updated_at()\"\n        },\n        {\n            \"table\": \"notifications\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_notifications_set_updated_at\",\n            \"definition\": \"CREATE TRIGGER trg_notifications_set_updated_at BEFORE UPDATE ON notifications FOR EACH ROW EXECUTE FUNCTION notifications_set_updated_at()\"\n        },\n        {\n            \"table\": \"request_cell_locks\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_touch_request_cell_locks\",\n            \"definition\": \"CREATE TRIGGER trg_touch_request_cell_locks BEFORE UPDATE ON request_cell_locks FOR EACH ROW EXECUTE FUNCTION touch_updated_at()\"\n        },\n        {\n            \"table\": \"requests\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_max_5_requests\",\n            \"definition\": \"CREATE TRIGGER trg_max_5_requests BEFORE INSERT ON requests FOR EACH ROW EXECUTE FUNCTION enforce_max_5_requests_per_week()\"\n        },\n        {\n            \"table\": \"requests\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_off_priority_rules\",\n            \"definition\": \"CREATE TRIGGER trg_off_priority_rules BEFORE INSERT OR UPDATE ON requests FOR EACH ROW EXECUTE FUNCTION enforce_off_priority_rules()\"\n        },\n        {\n            \"table\": \"rota_assignment_comments\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_comment_insert\",\n            \"definition\": \"CREATE TRIGGER trg_comment_insert BEFORE INSERT ON rota_assignment_comments FOR EACH ROW EXECUTE FUNCTION set_comment_created_audit()\"\n        },\n        {\n            \"table\": \"rota_assignment_comments\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_comment_update\",\n            \"definition\": \"CREATE TRIGGER trg_comment_update BEFORE UPDATE ON rota_assignment_comments FOR EACH ROW EXECUTE FUNCTION set_comment_updated_audit()\"\n        },\n        {\n            \"table\": \"rota_assignment_overrides\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_override_insert\",\n            \"definition\": \"CREATE TRIGGER trg_override_insert BEFORE INSERT ON rota_assignment_overrides FOR EACH ROW EXECUTE FUNCTION set_override_created_audit()\"\n        },\n        {\n            \"table\": \"rota_assignment_overrides\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_override_update\",\n            \"definition\": \"CREATE TRIGGER trg_override_update BEFORE UPDATE ON rota_assignment_overrides FOR EACH ROW EXECUTE FUNCTION set_override_updated_audit()\"\n        },\n        {\n            \"table\": \"staffing_requirements\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trigger_update_staffing_requirements_updated_at\",\n            \"definition\": \"CREATE TRIGGER trigger_update_staffing_requirements_updated_at BEFORE UPDATE ON staffing_requirements FOR EACH ROW EXECUTE FUNCTION update_staffing_requirements_updated_at()\"\n        },\n        {\n            \"table\": \"week_comments\",\n            \"enabled\": \"O\",\n            \"trigger\": \"trg_week_comments_updated_at\",\n            \"definition\": \"CREATE TRIGGER trg_week_comments_updated_at BEFORE UPDATE ON week_comments FOR EACH ROW EXECUTE FUNCTION set_week_comments_updated_at()\"\n        }\n    ],\n    \"functions\": [\n        {\n            \"name\": \"_require_admin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public._require_admin(p_admin_id uuid, p_pin text)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not exists (\\r\\n    select 1\\r\\n    from public.users\\r\\n    where id = p_admin_id\\r\\n      and is_admin = true\\r\\n      and is_active = true\\r\\n      and pin_hash = crypt(p_pin, pin_hash)\\r\\n  ) then\\r\\n    raise exception 'Invalid admin PIN';\\r\\n  end if;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"ack_notice\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.ack_notice(p_notice_id uuid, p_user_id uuid, p_version integer)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nBEGIN\\r\\n  INSERT INTO public.notice_ack (notice_id, user_id, version, acknowledged_at)\\r\\n  VALUES (p_notice_id, p_user_id, p_version, now())\\r\\n  ON CONFLICT (notice_id, user_id)\\r\\n  DO UPDATE SET\\r\\n    version = EXCLUDED.version,\\r\\n    acknowledged_at = now();\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_notice_id uuid, p_user_id uuid, p_version integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"acknowledge_notice\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.acknowledge_notice(p_user_id uuid, p_pin text, p_notice_id uuid)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not exists (\\r\\n    select 1\\r\\n    from public.users\\r\\n    where id = p_user_id\\r\\n      and pin_hash = crypt(p_pin, pin_hash)\\r\\n      and is_active = true\\r\\n  ) then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  insert into public.notice_ack (notice_id, user_id)\\r\\n  values (p_notice_id, p_user_id)\\r\\n  on conflict (notice_id, user_id) do nothing;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_notice_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_approve_swap_request\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(success boolean, swap_execution_id uuid, error_message text)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_approve_swap_request(p_admin_id uuid, p_pin text, p_swap_request_id uuid)\\n RETURNS TABLE(success boolean, swap_execution_id uuid, error_message text)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_swap_req swap_requests;\\r\\n  v_admin_name text;\\r\\n  v_is_admin boolean;\\r\\n  v_initiator_name text;\\r\\n  v_counterparty_name text;\\r\\n  v_swap_exec_id uuid;\\r\\n  v_initiator_shift_id bigint;\\r\\n  v_counterparty_shift_id bigint;\\r\\nbegin\\r\\n  -- Verify admin/rota.swap permission\\r\\n  select name, is_admin into v_admin_name, v_is_admin from public.users where id = p_admin_id and is_active = true;\\r\\n  if v_admin_name is null then\\r\\n    return query select false, null::uuid, 'Admin not found or inactive'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  if not v_is_admin then\\r\\n    if to_regclass('public.user_permission_assignments') is null or to_regclass('public.permission_items') is null then\\r\\n      return query select false, null::uuid, 'Permission system not installed'::text;\\r\\n      return;\\r\\n    end if;\\r\\n\\r\\n    if not exists(\\r\\n      select 1 from user_permission_assignments upa\\r\\n      join permission_items pi on pi.id = upa.permission_id\\r\\n      where upa.user_id = p_admin_id\\r\\n        and pi.key = 'rota.swap'\\r\\n        and upa.assigned_at <= now()\\r\\n        and (upa.revoked_at is null or upa.revoked_at > now())\\r\\n    ) then\\r\\n      return query select false, null::uuid, 'Permission denied: rota.swap not assigned'::text;\\r\\n      return;\\r\\n    end if;\\r\\n  end if;\\r\\n\\r\\n  -- Get swap request\\r\\n  select * into v_swap_req from swap_requests where id = p_swap_request_id;\\r\\n  if v_swap_req is null then\\r\\n    return query select false, null::uuid, 'Swap request not found'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Get names\\r\\n  select name into v_initiator_name from public.users where id = v_swap_req.initiator_user_id;\\r\\n  select name into v_counterparty_name from public.users where id = v_swap_req.counterparty_user_id;\\r\\n\\r\\n  -- Execute swap\\r\\n  select shift_id into v_initiator_shift_id from rota_assignments\\r\\n    where user_id = v_swap_req.initiator_user_id and date = v_swap_req.initiator_shift_date;\\r\\n  select shift_id into v_counterparty_shift_id from rota_assignments\\r\\n    where user_id = v_swap_req.counterparty_user_id and date = v_swap_req.counterparty_shift_date;\\r\\n\\r\\n  -- Swap both shift_id AND date\\r\\n  update rota_assignments\\r\\n    set shift_id = v_counterparty_shift_id,\\r\\n        date = v_swap_req.counterparty_shift_date\\r\\n    where user_id = v_swap_req.initiator_user_id and date = v_swap_req.initiator_shift_date;\\r\\n\\r\\n  update rota_assignments\\r\\n    set shift_id = v_initiator_shift_id,\\r\\n        date = v_swap_req.initiator_shift_date\\r\\n    where user_id = v_swap_req.counterparty_user_id and date = v_swap_req.counterparty_shift_date;\\r\\n\\r\\n  -- Record swap execution\\r\\n  insert into swap_executions(\\r\\n    swap_request_id, method, period_id,\\r\\n    initiator_week_id, counterparty_week_id,\\r\\n    initiator_user_id, initiator_name,\\r\\n    counterparty_user_id, counterparty_name,\\r\\n    authoriser_user_id, authoriser_name,\\r\\n    initiator_old_shift_code, initiator_old_shift_date, initiator_new_shift_code, initiator_new_shift_date,\\r\\n    counterparty_old_shift_code, counterparty_old_shift_date, counterparty_new_shift_code, counterparty_new_shift_date\\r\\n  )\\r\\n  values(\\r\\n    p_swap_request_id, 'staff_approved', null::integer,\\r\\n    v_swap_req.initiator_week_id, v_swap_req.counterparty_week_id,\\r\\n    v_swap_req.initiator_user_id, v_initiator_name,\\r\\n    v_swap_req.counterparty_user_id, v_counterparty_name,\\r\\n    p_admin_id, v_admin_name,\\r\\n    v_swap_req.initiator_shift_code, v_swap_req.initiator_shift_date, v_swap_req.counterparty_shift_code, v_swap_req.counterparty_shift_date,\\r\\n    v_swap_req.counterparty_shift_code, v_swap_req.counterparty_shift_date, v_swap_req.initiator_shift_code, v_swap_req.initiator_shift_date\\r\\n  )\\r\\n  returning swap_executions.id into v_swap_exec_id;\\r\\n\\r\\n  -- Update swap request status\\r\\n  update swap_requests\\r\\n    set status = 'approved_by_admin',\\r\\n        admin_user_id = p_admin_id,\\r\\n        admin_decided_at = now(),\\r\\n        admin_decision = 'approved'\\r\\n    where id = p_swap_request_id;\\r\\n\\r\\n  -- Create system comments on both cells\\r\\n  if to_regclass('public.rota_assignment_comments') is not null then\\r\\n    insert into rota_assignment_comments(rota_assignment_id, comment, is_admin_only, created_by, created_at)\\r\\n    select ra.id,\\r\\n      format('Swap: %s %s (%s) was swapped with %s %s (%s). Requested by: %s. Authorised by: %s (Admin)',\\r\\n        v_initiator_name, to_char(v_swap_req.initiator_shift_date, 'Dy DD Mon'), v_swap_req.counterparty_shift_code,\\r\\n        v_counterparty_name, to_char(v_swap_req.counterparty_shift_date, 'Dy DD Mon'), v_swap_req.initiator_shift_code,\\r\\n        v_initiator_name, v_admin_name),\\r\\n      false, p_admin_id, now()\\r\\n    from rota_assignments ra\\r\\n    where ra.user_id = v_swap_req.initiator_user_id\\r\\n      and ra.date = v_swap_req.counterparty_shift_date;\\r\\n\\r\\n    insert into rota_assignment_comments(rota_assignment_id, comment, is_admin_only, created_by, created_at)\\r\\n    select ra.id,\\r\\n      format('Swap: %s %s (%s) was swapped with %s %s (%s). Requested by: %s. Authorised by: %s (Admin)',\\r\\n        v_counterparty_name, to_char(v_swap_req.counterparty_shift_date, 'Dy DD Mon'), v_swap_req.initiator_shift_code,\\r\\n        v_initiator_name, to_char(v_swap_req.initiator_shift_date, 'Dy DD Mon'), v_swap_req.counterparty_shift_code,\\r\\n        v_initiator_name, v_admin_name),\\r\\n      false, p_admin_id, now()\\r\\n    from rota_assignments ra\\r\\n    where ra.user_id = v_swap_req.counterparty_user_id\\r\\n      and ra.date = v_swap_req.initiator_shift_date;\\r\\n  end if;\\r\\n\\r\\n  return query select true, v_swap_exec_id, null::text;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_swap_request_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_clear_request_cell\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_clear_request_cell(p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  u public.users;\\r\\nbegin\\r\\n  select * into u from public.users where id = p_admin_id;\\r\\n  if not found then raise exception 'Admin not found'; end if;\\r\\n  if coalesce(u.is_admin,false) is not true then raise exception 'Admin only'; end if;\\r\\n\\r\\n  if crypt(p_pin, u.pin_hash) <> u.pin_hash then\\r\\n    raise exception 'invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  delete from public.requests\\r\\n  where user_id = p_target_user_id\\r\\n    and date = p_date;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_create_five_week_period\",\n            \"schema\": \"public\",\n            \"returns\": \"uuid\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_create_five_week_period(p_admin_id uuid, p_pin text, p_name text, p_start_date date, p_end_date date)\\n RETURNS uuid\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public', 'extensions'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\n  v_period_id uuid;\\r\\n  v_week_id uuid;\\r\\n  d date;\\r\\n  week_start date;\\r\\n  week_end date;\\r\\nbegin\\r\\n  -- verify admin + pin\\r\\n  select public.verify_user_pin(p_admin_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'Bad PIN';\\r\\n  end if;\\r\\n\\r\\n  if not exists (\\r\\n    select 1 from public.users u\\r\\n    where u.id = p_admin_id and coalesce(u.is_admin,false) = true\\r\\n  ) then\\r\\n    raise exception 'Admin only';\\r\\n  end if;\\r\\n\\r\\n  -- sanity check: must be exactly 35 days\\r\\n  if (p_end_date - p_start_date) <> 34 then\\r\\n    raise exception 'Expected 35-day range (end-start = 34)';\\r\\n  end if;\\r\\n\\r\\n  -- create period\\r\\n  insert into public.rota_periods (name, start_date, end_date, is_active, is_hidden)\\r\\n  values (p_name, p_start_date, p_end_date, false, false)\\r\\n  returning id into v_period_id;\\r\\n\\r\\n  -- create weeks + dates\\r\\n  d := p_start_date;\\r\\n\\r\\n  while d <= p_end_date loop\\r\\n    -- Sunday-based weeks\\r\\n    week_start := d - extract(dow from d)::int;\\r\\n    week_end   := week_start + 6;\\r\\n\\r\\n    -- new week block\\r\\n    if d = week_start then\\r\\n      insert into public.rota_weeks (\\r\\n        week_start,\\r\\n        week_end,\\r\\n        open,\\r\\n        open_after_close\\r\\n      )\\r\\n      values (\\r\\n        week_start,\\r\\n        week_end,\\r\\n        true,\\r\\n        false\\r\\n      )\\r\\n      returning id into v_week_id;\\r\\n    end if;\\r\\n\\r\\n    insert into public.rota_dates (date, period_id, week_id)\\r\\n    values (d, v_period_id, v_week_id);\\r\\n\\r\\n    d := d + 1;\\r\\n  end loop;\\r\\n\\r\\n  return v_period_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_name text, p_start_date date, p_end_date date\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_create_next_period\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(period_id bigint, start_date date, end_date date)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_create_next_period(p_admin_user_id uuid)\\n RETURNS TABLE(period_id bigint, start_date date, end_date date)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  last_end date;\\r\\n  start_d date;\\r\\n  end_d date;\\r\\n  pid bigint;\\r\\n  week_start date;\\r\\n  week_id bigint;\\r\\n  i int;\\r\\n  d date;\\r\\nbegin\\r\\n  if not public.is_admin_user(p_admin_user_id) then\\r\\n    raise exception 'Not authorized';\\r\\n  end if;\\r\\n\\r\\n  select max(rp.end_date) into last_end from public.rota_periods rp;\\r\\n\\r\\n  if last_end is null then\\r\\n    start_d := (current_date - extract(dow from current_date)::int);\\r\\n  else\\r\\n    start_d := last_end + 1;\\r\\n  end if;\\r\\n\\r\\n  end_d := start_d + 34; -- 5 weeks\\r\\n\\r\\n  insert into public.rota_periods(start_date, end_date, is_hidden, is_active)\\r\\n  values (start_d, end_d, false, false)\\r\\n  returning id into pid;\\r\\n\\r\\n  for i in 0..4 loop\\r\\n    insert into public.rota_weeks(period_id, open)\\r\\n    values (pid, true)\\r\\n    returning id into week_id;\\r\\n\\r\\n    week_start := start_d + (i*7);\\r\\n\\r\\n    for d in (select generate_series(week_start, week_start + 6, interval '1 day')::date) loop\\r\\n      insert into public.rota_dates(date, week_id, period_id)\\r\\n      values (d, week_id, pid);\\r\\n    end loop;\\r\\n  end loop;\\r\\n\\r\\n  period_id := pid;\\r\\n  start_date := start_d;\\r\\n  end_date := end_d;\\r\\n  return next;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_user_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_decline_swap_request\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(success boolean, error_message text)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_decline_swap_request(p_admin_id uuid, p_pin text, p_swap_request_id uuid)\\n RETURNS TABLE(success boolean, error_message text)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_admin_name text;\\r\\n  v_is_admin boolean;\\r\\nbegin\\r\\n  -- Verify admin/rota.swap permission\\r\\n  select name, is_admin into v_admin_name, v_is_admin from public.users where id = p_admin_id and is_active = true;\\r\\n  if v_admin_name is null then\\r\\n    return query select false, 'Admin not found or inactive'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  if not v_is_admin then\\r\\n    if to_regclass('public.user_permission_assignments') is null or to_regclass('public.permission_items') is null then\\r\\n      return query select false, 'Permission system not installed'::text;\\r\\n      return;\\r\\n    end if;\\r\\n\\r\\n    if not exists(\\r\\n      select 1 from user_permission_assignments upa\\r\\n      join permission_items pi on pi.id = upa.permission_id\\r\\n      where upa.user_id = p_admin_id\\r\\n        and pi.key = 'rota.swap'\\r\\n        and upa.assigned_at <= now()\\r\\n        and (upa.revoked_at is null or upa.revoked_at > now())\\r\\n    ) then\\r\\n      return query select false, 'Permission denied: rota.swap not assigned'::text;\\r\\n      return;\\r\\n    end if;\\r\\n  end if;\\r\\n\\r\\n  if not exists(select 1 from swap_requests where id = p_swap_request_id) then\\r\\n    return query select false, 'Swap request not found'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  update swap_requests\\r\\n    set status = 'declined_by_admin',\\r\\n        admin_user_id = p_admin_id,\\r\\n        admin_decided_at = now(),\\r\\n        admin_decision = 'declined'\\r\\n    where id = p_swap_request_id;\\r\\n\\r\\n  return query select true, null::text;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_swap_request_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_delete_notice\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_delete_notice(p_admin_id uuid, p_pin text, p_notice_id uuid)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_is_admin boolean;\\r\\n  v_ok boolean;\\r\\nbegin\\r\\n  select is_admin into v_is_admin\\r\\n  from public.users\\r\\n  where public.users.id = p_admin_id;\\r\\n\\r\\n  if coalesce(v_is_admin,false) = false then\\r\\n    raise exception 'Admin only';\\r\\n  end if;\\r\\n\\r\\n  select public.verify_user_pin(p_admin_id, p_pin) into v_ok;\\r\\n  if v_ok is not true then\\r\\n    raise exception 'Bad PIN';\\r\\n  end if;\\r\\n\\r\\n  delete from public.notices\\r\\n  where public.notices.id = p_notice_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_notice_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_execute_shift_swap\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(success boolean, swap_execution_id uuid, error_message text)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_execute_shift_swap(p_admin_id uuid, p_pin text, p_initiator_user_id uuid, p_initiator_shift_date date, p_counterparty_user_id uuid, p_counterparty_shift_date date, p_period_id integer DEFAULT NULL::integer)\\n RETURNS TABLE(success boolean, swap_execution_id uuid, error_message text)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_admin_name text;\\r\\n  v_is_admin boolean;\\r\\n  v_initiator_name text;\\r\\n  v_counterparty_name text;\\r\\n  v_initiator_shift_code text;\\r\\n  v_counterparty_shift_code text;\\r\\n  v_initiator_week_id integer;\\r\\n  v_counterparty_week_id integer;\\r\\n  v_swap_exec_id uuid;\\r\\n  v_initiator_shift_id bigint;\\r\\n  v_counterparty_shift_id bigint;\\r\\n  v_initiator_role_id integer;\\r\\n  v_counterparty_role_id integer;\\r\\n  v_same_week boolean;\\r\\nbegin\\r\\n  -- Verify admin/rota.swap permission\\r\\n  select name, is_admin into v_admin_name, v_is_admin from public.users where id = p_admin_id and is_active = true;\\r\\n  if v_admin_name is null then\\r\\n    return query select false, null::uuid, 'Admin not found or inactive'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  if not v_is_admin then\\r\\n    if to_regclass('public.user_permission_assignments') is null or to_regclass('public.permission_items') is null then\\r\\n      return query select false, null::uuid, 'Permission system not installed'::text;\\r\\n      return;\\r\\n    end if;\\r\\n\\r\\n    if not exists(\\r\\n      select 1 from user_permission_assignments upa\\r\\n      join permission_items pi on pi.id = upa.permission_id\\r\\n      where upa.user_id = p_admin_id\\r\\n        and pi.key = 'rota.swap'\\r\\n        and upa.assigned_at <= now()\\r\\n        and (upa.revoked_at is null or upa.revoked_at > now())\\r\\n    ) then\\r\\n      return query select false, null::uuid, 'Permission denied: rota.swap not assigned'::text;\\r\\n      return;\\r\\n    end if;\\r\\n  end if;\\r\\n\\r\\n  -- Get initiator name and shift info\\r\\n  select u.name, u.role_id, s.code, null::integer\\r\\n    into v_initiator_name, v_initiator_role_id, v_initiator_shift_code, v_initiator_week_id\\r\\n    from public.users u\\r\\n    join rota_assignments ra on ra.user_id = u.id\\r\\n    join shifts s on s.id = ra.shift_id\\r\\n    where u.id = p_initiator_user_id\\r\\n      and ra.date = p_initiator_shift_date\\r\\n    limit 1;\\r\\n\\r\\n  if v_initiator_name is null then\\r\\n    -- Check if user exists\\r\\n    if not exists(select 1 from public.users where id = p_initiator_user_id) then\\r\\n      return query select false, null::uuid, 'Initiator user not found'::text;\\r\\n      return;\\r\\n    end if;\\r\\n    -- Check if assignment exists\\r\\n    if not exists(select 1 from rota_assignments where user_id = p_initiator_user_id and date = p_initiator_shift_date) then\\r\\n      return query select false, null::uuid, format('No assignment found for initiator on %s', p_initiator_shift_date)::text;\\r\\n      return;\\r\\n    end if;\\r\\n    -- Check if shift_id is null\\r\\n    if exists(select 1 from rota_assignments where user_id = p_initiator_user_id and date = p_initiator_shift_date and shift_id is null) then\\r\\n      return query select false, null::uuid, 'Initiator assignment has no shift assigned'::text;\\r\\n      return;\\r\\n    end if;\\r\\n    return query select false, null::uuid, 'Initiator shift not found (unknown reason)'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Get counterparty name and shift info\\r\\n  select u.name, u.role_id, s.code, null::integer\\r\\n    into v_counterparty_name, v_counterparty_role_id, v_counterparty_shift_code, v_counterparty_week_id\\r\\n    from public.users u\\r\\n    join rota_assignments ra on ra.user_id = u.id\\r\\n    join shifts s on s.id = ra.shift_id\\r\\n    where u.id = p_counterparty_user_id\\r\\n      and ra.date = p_counterparty_shift_date\\r\\n    limit 1;\\r\\n\\r\\n  if v_counterparty_name is null then\\r\\n    -- Check if user exists\\r\\n    if not exists(select 1 from public.users where id = p_counterparty_user_id) then\\r\\n      return query select false, null::uuid, 'Counterparty user not found'::text;\\r\\n      return;\\r\\n    end if;\\r\\n    -- Check if assignment exists\\r\\n    if not exists(select 1 from rota_assignments where user_id = p_counterparty_user_id and date = p_counterparty_shift_date) then\\r\\n      return query select false, null::uuid, format('No assignment found for counterparty on %s', p_counterparty_shift_date)::text;\\r\\n      return;\\r\\n    end if;\\r\\n    -- Check if shift_id is null\\r\\n    if exists(select 1 from rota_assignments where user_id = p_counterparty_user_id and date = p_counterparty_shift_date and shift_id is null) then\\r\\n      return query select false, null::uuid, 'Counterparty assignment has no shift assigned'::text;\\r\\n      return;\\r\\n    end if;\\r\\n    return query select false, null::uuid, 'Counterparty shift not found (unknown reason)'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Validate swap rules based on role_id\\r\\n  -- role_id 3 = Nursing Assistant: can only swap within same week and with other Nursing Assistants\\r\\n  -- role_id 1,2 = Charge/Staff Nurse: can swap freely\\r\\n  v_same_week := date_trunc('week', p_initiator_shift_date::timestamp) = date_trunc('week', p_counterparty_shift_date::timestamp);\\r\\n  \\r\\n  -- Nursing Assistants (role_id 3) can only swap within same week and with other Nursing Assistants\\r\\n  if v_initiator_role_id = 3 or v_counterparty_role_id = 3 then\\r\\n    if not v_same_week then\\r\\n      return query select false, null::uuid, 'Nursing Assistants can only swap shifts within the same week'::text;\\r\\n      return;\\r\\n    end if;\\r\\n    \\r\\n    -- Both users must be Nursing Assistants\\r\\n    if v_initiator_role_id != 3 or v_counterparty_role_id != 3 then\\r\\n      return query select false, null::uuid, 'Nursing Assistants can only swap with other Nursing Assistants'::text;\\r\\n      return;\\r\\n    end if;\\r\\n  end if;\\r\\n\\r\\n  -- Execute swap: swap rota_assignments shift_id\\r\\n  select shift_id into v_initiator_shift_id from rota_assignments\\r\\n    where user_id = p_initiator_user_id and date = p_initiator_shift_date;\\r\\n  select shift_id into v_counterparty_shift_id from rota_assignments\\r\\n    where user_id = p_counterparty_user_id and date = p_counterparty_shift_date;\\r\\n\\r\\n  -- Debug: return the shift IDs for verification\\r\\n  if v_initiator_shift_id is null or v_counterparty_shift_id is null then\\r\\n    return query select false, null::uuid, format('Debug: initiator_shift_id=%s, counterparty_shift_id=%s', v_initiator_shift_id, v_counterparty_shift_id)::text;\\r\\n    return;\\r\\n  end if;\\r\\n  \\r\\n  -- Swap both shift_id AND date\\r\\n  update rota_assignments\\r\\n    set shift_id = v_counterparty_shift_id,\\r\\n        date = p_counterparty_shift_date\\r\\n    where user_id = p_initiator_user_id and date = p_initiator_shift_date;\\r\\n\\r\\n  if not found then\\r\\n    return query select false, null::uuid, 'UPDATE failed for initiator assignment'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  update rota_assignments\\r\\n    set shift_id = v_initiator_shift_id,\\r\\n        date = p_initiator_shift_date\\r\\n    where user_id = p_counterparty_user_id and date = p_counterparty_shift_date;\\r\\n\\r\\n  if not found then\\r\\n    return query select false, null::uuid, 'UPDATE failed for counterparty assignment'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Record swap execution\\r\\n  insert into swap_executions(\\r\\n    method, period_id, initiator_week_id, counterparty_week_id,\\r\\n    initiator_user_id, initiator_name,\\r\\n    counterparty_user_id, counterparty_name,\\r\\n    authoriser_user_id, authoriser_name,\\r\\n    initiator_old_shift_code, initiator_old_shift_date, initiator_new_shift_code, initiator_new_shift_date,\\r\\n    counterparty_old_shift_code, counterparty_old_shift_date, counterparty_new_shift_code, counterparty_new_shift_date\\r\\n  )\\r\\n  values(\\r\\n    'admin_direct', null::integer, v_initiator_week_id, v_counterparty_week_id,\\r\\n    p_initiator_user_id, v_initiator_name,\\r\\n    p_counterparty_user_id, v_counterparty_name,\\r\\n    p_admin_id, v_admin_name,\\r\\n    v_initiator_shift_code, p_initiator_shift_date, v_counterparty_shift_code, p_counterparty_shift_date,\\r\\n    v_counterparty_shift_code, p_counterparty_shift_date, v_initiator_shift_code, p_initiator_shift_date\\r\\n  )\\r\\n  returning swap_executions.id into v_swap_exec_id;\\r\\n\\r\\n  -- Create system comments on both cells\\r\\n  if to_regclass('public.rota_assignment_comments') is not null then\\r\\n    insert into rota_assignment_comments(rota_assignment_id, comment, is_admin_only, created_by, created_at)\\r\\n    select ra.id, \\r\\n      format('Swap: %s %s (%s) was swapped with %s %s (%s). Authorised by: %s (Admin)',\\r\\n        v_initiator_name, to_char(p_initiator_shift_date, 'Dy DD Mon'), v_counterparty_shift_code,\\r\\n        v_counterparty_name, to_char(p_counterparty_shift_date, 'Dy DD Mon'), v_initiator_shift_code,\\r\\n        v_admin_name),\\r\\n      false, p_admin_id, now()\\r\\n    from rota_assignments ra\\r\\n    where ra.user_id = p_initiator_user_id\\r\\n      and ra.date = p_counterparty_shift_date;\\r\\n\\r\\n    insert into rota_assignment_comments(rota_assignment_id, comment, is_admin_only, created_by, created_at)\\r\\n    select ra.id,\\r\\n      format('Swap: %s %s (%s) was swapped with %s %s (%s). Authorised by: %s (Admin)',\\r\\n        v_counterparty_name, to_char(p_counterparty_shift_date, 'Dy DD Mon'), v_initiator_shift_code,\\r\\n        v_initiator_name, to_char(p_initiator_shift_date, 'Dy DD Mon'), v_counterparty_shift_code,\\r\\n        v_admin_name),\\r\\n      false, p_admin_id, now()\\r\\n    from rota_assignments ra\\r\\n    where ra.user_id = p_counterparty_user_id\\r\\n      and ra.date = p_initiator_shift_date;\\r\\n  end if;\\r\\n\\r\\n  return query select true, v_swap_exec_id, null::text;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_initiator_user_id uuid, p_initiator_shift_date date, p_counterparty_user_id uuid, p_counterparty_shift_date date, p_period_id integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_get_all_notices\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(notice_id uuid, title text, body_en text, body_es text, version integer, is_active boolean, updated_at timestamp with time zone, created_by_name text, target_all boolean, target_roles integer[])\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_get_all_notices(p_admin_id uuid, p_pin text)\\n RETURNS TABLE(notice_id uuid, title text, body_en text, body_es text, version integer, is_active boolean, updated_at timestamp with time zone, created_by_name text, target_all boolean, target_roles integer[])\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_ok boolean;\\r\\n  v_is_admin boolean;\\r\\nbegin\\r\\n  select is_admin into v_is_admin\\r\\n  from public.users\\r\\n  where public.users.id = p_admin_id;\\r\\n\\r\\n  if v_is_admin is not true then\\r\\n    raise exception 'Admin only';\\r\\n  end if;\\r\\n\\r\\n  select public.verify_user_pin(p_admin_id, p_pin) into v_ok;\\r\\n  if v_ok is not true then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  return query\\r\\n  select\\r\\n    n.id as notice_id,\\r\\n    n.title,\\r\\n    n.body_en,\\r\\n    n.body_es,\\r\\n    n.version,\\r\\n    n.is_active,\\r\\n    n.updated_at,\\r\\n    u.name as created_by_name,\\r\\n    n.target_all,\\r\\n    n.target_roles\\r\\n  from public.notices n\\r\\n  join public.users u\\r\\n    on u.id = n.created_by\\r\\n  order by n.updated_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_get_notice_acks\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(acked jsonb, pending jsonb)\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_get_notice_acks(p_admin_id uuid DEFAULT NULL::uuid, p_pin text DEFAULT NULL::text, p_notice_id uuid DEFAULT NULL::uuid)\\n RETURNS TABLE(acked jsonb, pending jsonb)\\n LANGUAGE sql\\n STABLE SECURITY DEFINER\\nAS $function$\\r\\n  select\\r\\n    coalesce(\\r\\n      jsonb_agg(\\r\\n        jsonb_build_object(\\r\\n          'name', u.name,\\r\\n          'acknowledged_at', a.acknowledged_at\\r\\n        ) order by a.acknowledged_at desc\\r\\n      ) filter (where a.user_id is not null),\\r\\n      '[]'::jsonb\\r\\n    ) as acked,\\r\\n    '[]'::jsonb as pending\\r\\n  from public.notice_ack a\\r\\n  left join public.users u on u.id = a.user_id\\r\\n  where p_notice_id is not null and a.notice_id = p_notice_id;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_notice_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_get_swap_executions\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, period_id integer, initiator_name text, counterparty_name text, authoriser_name text, initiator_date date, initiator_old_shift text, initiator_new_shift text, counterparty_date date, counterparty_old_shift text, counterparty_new_shift text, method text, executed_at timestamp without time zone)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_get_swap_executions(p_admin_id uuid, p_pin text, p_period_id integer DEFAULT NULL::integer)\\n RETURNS TABLE(id uuid, period_id integer, initiator_name text, counterparty_name text, authoriser_name text, initiator_date date, initiator_old_shift text, initiator_new_shift text, counterparty_date date, counterparty_old_shift text, counterparty_new_shift text, method text, executed_at timestamp without time zone)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_admin_exists boolean;\\r\\nbegin\\r\\n  select exists(select 1 from public.users where id = p_admin_id and is_active = true) into v_admin_exists;\\r\\n  if not v_admin_exists then\\r\\n    raise exception 'Admin not found or inactive';\\r\\n  end if;\\r\\n\\r\\n  return query\\r\\n  select \\r\\n    swap_executions.id,\\r\\n    swap_executions.period_id,\\r\\n    swap_executions.initiator_name,\\r\\n    swap_executions.counterparty_name,\\r\\n    swap_executions.authoriser_name,\\r\\n    swap_executions.initiator_old_shift_date,\\r\\n    swap_executions.initiator_old_shift_code,\\r\\n    swap_executions.initiator_new_shift_code,\\r\\n    swap_executions.counterparty_old_shift_date,\\r\\n    swap_executions.counterparty_old_shift_code,\\r\\n    swap_executions.counterparty_new_shift_code,\\r\\n    swap_executions.method,\\r\\n    swap_executions.executed_at\\r\\n  from swap_executions\\r\\n  where (p_period_id is null or p_period_id = 0 or swap_executions.period_id = p_period_id)\\r\\n  order by swap_executions.executed_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_period_id integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_get_swap_requests\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, period_id integer, initiator_name text, counterparty_name text, initiator_shift_date date, initiator_shift_code text, counterparty_shift_date date, counterparty_shift_code text, status text, counterparty_response text, counterparty_responded_at timestamp without time zone, created_at timestamp without time zone)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_get_swap_requests(p_admin_id uuid, p_pin text)\\n RETURNS TABLE(id uuid, period_id integer, initiator_name text, counterparty_name text, initiator_shift_date date, initiator_shift_code text, counterparty_shift_date date, counterparty_shift_code text, status text, counterparty_response text, counterparty_responded_at timestamp without time zone, created_at timestamp without time zone)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_admin_exists boolean;\\r\\nbegin\\r\\n  select exists(select 1 from public.users where id = p_admin_id and is_active = true) into v_admin_exists;\\r\\n  if not v_admin_exists then\\r\\n    raise exception 'Admin not found or inactive';\\r\\n  end if;\\r\\n\\r\\n  return query\\r\\n  select \\r\\n    swap_requests.id, \\r\\n    swap_requests.period_id,\\r\\n    (select u.name from public.users u where u.id = swap_requests.initiator_user_id limit 1),\\r\\n    (select u.name from public.users u where u.id = swap_requests.counterparty_user_id limit 1),\\r\\n    swap_requests.initiator_shift_date, \\r\\n    swap_requests.initiator_shift_code,\\r\\n    swap_requests.counterparty_shift_date, \\r\\n    swap_requests.counterparty_shift_code,\\r\\n    swap_requests.status, \\r\\n    swap_requests.counterparty_response, \\r\\n    swap_requests.counterparty_responded_at,\\r\\n    swap_requests.created_at\\r\\n  from swap_requests\\r\\n  order by swap_requests.created_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_lock_request_cell\",\n            \"schema\": \"public\",\n            \"returns\": \"request_cell_locks\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_lock_request_cell(p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date, p_reason_en text DEFAULT NULL::text, p_reason_es text DEFAULT NULL::text)\\n RETURNS request_cell_locks\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  a public.users;\\r\\n  row public.request_cell_locks;\\r\\nbegin\\r\\n  select * into a from public.users where id = p_admin_id;\\r\\n  if not found then raise exception 'Admin not found'; end if;\\r\\n  if coalesce(a.is_admin,false) is not true then raise exception 'Admin only'; end if;\\r\\n\\r\\n  if not public.verify_user_pin(p_admin_id, p_pin) then\\r\\n    raise exception 'invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  insert into public.request_cell_locks(user_id, date, reason_en, reason_es, locked_by)\\r\\n  values (p_target_user_id, p_date, nullif(p_reason_en,''), nullif(p_reason_es,''), p_admin_id)\\r\\n  on conflict (user_id, date)\\r\\n  do update set\\r\\n    reason_en = excluded.reason_en,\\r\\n    reason_es = excluded.reason_es,\\r\\n    locked_by = excluded.locked_by,\\r\\n    locked_at = now()\\r\\n  returning * into row;\\r\\n\\r\\n  return row;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date, p_reason_en text, p_reason_es text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_notice_ack_counts\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(notice_id uuid, ack_count bigint, ack_total bigint)\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_notice_ack_counts(p_admin_id uuid DEFAULT NULL::uuid, p_pin text DEFAULT NULL::text, p_notice_ids uuid[] DEFAULT NULL::uuid[])\\n RETURNS TABLE(notice_id uuid, ack_count bigint, ack_total bigint)\\n LANGUAGE sql\\n STABLE\\nAS $function$\\r\\n  select\\r\\n    n.id as notice_id,\\r\\n    coalesce(a.ack_count,0)::bigint as ack_count,\\r\\n    coalesce(\\r\\n      case\\r\\n        when n.target_all = true then (select count(*) from public.users u where u.is_active = true)\\r\\n        when n.target_roles is not null then (select count(*) from public.users u where u.is_active = true and u.role_id::int = any(n.target_roles))\\r\\n        else 0\\r\\n      end, 0)::bigint as ack_total\\r\\n  from public.notices n\\r\\n  left join (\\r\\n    select notice_id, count(*) as ack_count\\r\\n    from public.notice_ack\\r\\n    where p_notice_ids is null or notice_id = any(p_notice_ids)\\r\\n    group by notice_id\\r\\n  ) a on a.notice_id = n.id\\r\\n  where p_notice_ids is null or n.id = any(p_notice_ids);\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_notice_ids uuid[]\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"admin_set_active_period\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_active_period(p_admin_id uuid, p_pin text, p_period_id uuid)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public', 'extensions'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\nbegin\\r\\n  -- verify admin + pin (uses your existing RPC)\\r\\n  select public.verify_user_pin(p_admin_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'Bad PIN';\\r\\n  end if;\\r\\n\\r\\n  if not exists (\\r\\n    select 1 from public.users u\\r\\n    where u.id = p_admin_id and coalesce(u.is_admin,false) = true\\r\\n  ) then\\r\\n    raise exception 'Admin only';\\r\\n  end if;\\r\\n\\r\\n  -- IMPORTANT: safe update = always include WHERE\\r\\n  update public.rota_periods\\r\\n  set is_active = false\\r\\n  where is_active = true;\\r\\n\\r\\n  update public.rota_periods\\r\\n  set is_active = true\\r\\n  where id = p_period_id;\\r\\n\\r\\n  if not found then\\r\\n    raise exception 'Period not found: %', p_period_id;\\r\\n  end if;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_period_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_active_period\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_active_period(p_admin_user_id uuid, p_period_id bigint)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not public.is_admin_user(p_admin_user_id) then\\r\\n    raise exception 'Not authorized';\\r\\n  end if;\\r\\n\\r\\n  update public.rota_periods set is_active = false;\\r\\n  update public.rota_periods set is_active = true where id = p_period_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_user_id uuid, p_period_id bigint\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_notice_active\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_notice_active(p_admin_id uuid, p_pin text, p_notice_id uuid, p_active boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_is_admin boolean;\\r\\n  v_ok boolean;\\r\\nbegin\\r\\n  select is_admin into v_is_admin\\r\\n  from public.users\\r\\n  where public.users.id = p_admin_id;\\r\\n\\r\\n  if coalesce(v_is_admin,false) = false then\\r\\n    raise exception 'Admin only';\\r\\n  end if;\\r\\n\\r\\n  select public.verify_user_pin(p_admin_id, p_pin) into v_ok;\\r\\n  if v_ok is not true then\\r\\n    raise exception 'Bad PIN';\\r\\n  end if;\\r\\n\\r\\n  update public.notices\\r\\n  set\\r\\n    is_active = p_active,\\r\\n    updated_at = now()\\r\\n  where public.notices.id = p_notice_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_notice_id uuid, p_active boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_period_closes_at\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_period_closes_at(p_admin_id uuid, p_pin text, p_period_id uuid, p_closes_at timestamp with time zone)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\nbegin\\r\\n  perform public.assert_admin(p_admin_id, p_pin);\\r\\n\\r\\n  update public.rota_periods\\r\\n  set closes_at = p_closes_at\\r\\n  where id = p_period_id;\\r\\n\\r\\n  -- Optional default behavior: when setting a close time, shut \\\"after close\\\" flags\\r\\n  update public.rota_weeks w\\r\\n  set open_after_close = false\\r\\n  where w.id in (\\r\\n    select distinct d.week_id\\r\\n    from public.rota_dates d\\r\\n    where d.period_id = p_period_id\\r\\n      and d.week_id is not null\\r\\n  );\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_period_id uuid, p_closes_at timestamp with time zone\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_period_hidden\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_period_hidden(p_admin_user_id uuid, p_period_id bigint, p_hidden boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not public.is_admin_user(p_admin_user_id) then\\r\\n    raise exception 'Not authorized';\\r\\n  end if;\\r\\n\\r\\n  update public.rota_periods\\r\\n  set is_hidden = p_hidden\\r\\n  where id = p_period_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_user_id uuid, p_period_id bigint, p_hidden boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_request_cell\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(out_id uuid, out_user_id uuid, out_date date, out_value text, out_important_rank smallint)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_request_cell(p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date, p_value text, p_important_rank smallint DEFAULT NULL::smallint)\\n RETURNS TABLE(out_id uuid, out_user_id uuid, out_date date, out_value text, out_important_rank smallint)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nDECLARE\\r\\n  v_pin_hash TEXT;\\r\\n  v_is_admin BOOLEAN;\\r\\n  v_count INT;\\r\\n  v_week_start DATE;\\r\\n  v_week_end DATE;\\r\\nBEGIN\\r\\n  -- Verify admin PIN and status\\r\\n  SELECT pin_hash, is_admin INTO v_pin_hash, v_is_admin \\r\\n  FROM users WHERE users.id = p_admin_id;\\r\\n  \\r\\n  IF v_pin_hash IS NULL OR v_pin_hash != crypt(p_pin, v_pin_hash) THEN\\r\\n    RAISE EXCEPTION 'Invalid PIN';\\r\\n  END IF;\\r\\n  \\r\\n  IF NOT v_is_admin THEN\\r\\n    RAISE EXCEPTION 'Admin only';\\r\\n  END IF;\\r\\n\\r\\n  -- Calculate week boundaries (Sunday to Saturday)\\r\\n  v_week_start := p_date - (EXTRACT(DOW FROM p_date)::INT);\\r\\n  v_week_end := v_week_start + 6;\\r\\n\\r\\n  --  FIX: Count requests THIS WEEK for target user, EXCLUDING the current date\\r\\n  SELECT COUNT(*) INTO v_count\\r\\n  FROM requests\\r\\n  WHERE requests.user_id = p_target_user_id\\r\\n    AND requests.date >= v_week_start\\r\\n    AND requests.date <= v_week_end\\r\\n    AND requests.date != p_date;  --  KEY FIX: exclude current date\\r\\n\\r\\n  -- Only block if we're at 5 AND this is a NEW request (not an edit)\\r\\n  IF v_count >= 5 AND NOT EXISTS (\\r\\n    SELECT 1 FROM requests WHERE requests.user_id = p_target_user_id AND requests.date = p_date\\r\\n  ) THEN\\r\\n    RAISE EXCEPTION 'Max 5 requests per week';\\r\\n  END IF;\\r\\n\\r\\n  -- Upsert the request\\r\\n  RETURN QUERY\\r\\n  INSERT INTO requests (user_id, date, value, important_rank)\\r\\n  VALUES (p_target_user_id, p_date, p_value, p_important_rank)\\r\\n  ON CONFLICT (user_id, date) \\r\\n  DO UPDATE SET \\r\\n    value = EXCLUDED.value,\\r\\n    important_rank = EXCLUDED.important_rank,\\r\\n    updated_at = NOW()\\r\\n  RETURNING \\r\\n    requests.id AS out_id,\\r\\n    requests.user_id AS out_user_id,\\r\\n    requests.date AS out_date,\\r\\n    requests.value AS out_value,\\r\\n    requests.important_rank AS out_important_rank;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date, p_value text, p_important_rank smallint\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_week_open\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_week_open(p_admin_user_id uuid, p_week_id bigint, p_open boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not public.is_admin_user(p_admin_user_id) then\\r\\n    raise exception 'Not authorized';\\r\\n  end if;\\r\\n\\r\\n  update public.rota_weeks\\r\\n  set open = p_open\\r\\n  where id = p_week_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_user_id uuid, p_week_id bigint, p_open boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_set_week_open_flags\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_set_week_open_flags(p_admin_id uuid, p_pin text, p_week_id uuid, p_open boolean, p_open_after_close boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\nbegin\\r\\n  perform public.assert_admin(p_admin_id, p_pin);\\r\\n\\r\\n  update public.rota_weeks\\r\\n  set open = p_open,\\r\\n      open_after_close = p_open_after_close\\r\\n  where id = p_week_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_week_id uuid, p_open boolean, p_open_after_close boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_toggle_hidden_period\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_toggle_hidden_period(p_admin_id uuid, p_pin text, p_period_id uuid)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\nbegin\\r\\n  perform public.assert_admin(p_admin_id, p_pin);\\r\\n\\r\\n  update public.rota_periods\\r\\n  set is_hidden = not is_hidden\\r\\n  where id = p_period_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_period_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_unlock_request_cell\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_unlock_request_cell(p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  a public.users;\\r\\nbegin\\r\\n  select * into a from public.users where id = p_admin_id;\\r\\n  if not found then raise exception 'Admin not found'; end if;\\r\\n  if coalesce(a.is_admin,false) is not true then raise exception 'Admin only'; end if;\\r\\n\\r\\n  if not public.verify_user_pin(p_admin_id, p_pin) then\\r\\n    raise exception 'invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  delete from public.request_cell_locks\\r\\n  where user_id = p_target_user_id and date = p_date;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_target_user_id uuid, p_date date\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_upsert_notice\",\n            \"schema\": \"public\",\n            \"returns\": \"uuid\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_upsert_notice(p_admin_id uuid, p_pin text, p_notice_id uuid, p_title text, p_body_en text, p_body_es text, p_target_all boolean, p_target_roles integer[])\\n RETURNS uuid\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_is_admin boolean;\\r\\n  v_ok boolean;\\r\\n  v_id uuid;\\r\\nbegin\\r\\n  select is_admin into v_is_admin\\r\\n  from public.users\\r\\n  where public.users.id = p_admin_id;\\r\\n\\r\\n  if coalesce(v_is_admin,false) = false then\\r\\n    raise exception 'Admin only';\\r\\n  end if;\\r\\n\\r\\n  select public.verify_user_pin(p_admin_id, p_pin) into v_ok;\\r\\n  if v_ok is not true then\\r\\n    raise exception 'Bad PIN';\\r\\n  end if;\\r\\n\\r\\n  if p_notice_id is null then\\r\\n    insert into public.notices (\\r\\n      title,\\r\\n      body_en,\\r\\n      body_es,\\r\\n      created_by,\\r\\n      version,\\r\\n      is_active,\\r\\n      target_all,\\r\\n      target_roles\\r\\n    )\\r\\n    values (\\r\\n      p_title,\\r\\n      p_body_en,\\r\\n      p_body_es,\\r\\n      p_admin_id,\\r\\n      1,\\r\\n      true,\\r\\n      coalesce(p_target_all,true),\\r\\n      p_target_roles\\r\\n    )\\r\\n    returning public.notices.id into v_id;\\r\\n\\r\\n  else\\r\\n    update public.notices\\r\\n    set\\r\\n      title = p_title,\\r\\n      body_en = p_body_en,\\r\\n      body_es = p_body_es,\\r\\n      target_all = coalesce(p_target_all,true),\\r\\n      target_roles = p_target_roles,\\r\\n      version = coalesce(version,1) + 1,\\r\\n      updated_at = now()\\r\\n    where public.notices.id = p_notice_id\\r\\n    returning public.notices.id into v_id;\\r\\n  end if;\\r\\n\\r\\n  return v_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_notice_id uuid, p_title text, p_body_en text, p_body_es text, p_target_all boolean, p_target_roles integer[]\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"admin_upsert_user\",\n            \"schema\": \"public\",\n            \"returns\": \"uuid\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.admin_upsert_user(p_user_id uuid, p_name text, p_role_id integer)\\n RETURNS uuid\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare v_id uuid;\\r\\nbegin\\r\\n  if p_user_id is null then\\r\\n    insert into public.users (name, role_id, is_admin, is_active)\\r\\n    values (p_name, p_role_id, false, true)\\r\\n    returning id into v_id;\\r\\n  else\\r\\n    update public.users\\r\\n    set name = p_name,\\r\\n        role_id = p_role_id\\r\\n    where id = p_user_id\\r\\n    returning id into v_id;\\r\\n  end if;\\r\\n\\r\\n  return v_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_name text, p_role_id integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"assert_admin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.assert_admin(p_user_id uuid, p_pin text)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\n  isadmin boolean;\\r\\nbegin\\r\\n  select public.verify_user_pin(p_user_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'bad pin';\\r\\n  end if;\\r\\n\\r\\n  select u.is_admin into isadmin\\r\\n  from public.users u\\r\\n  where u.id = p_user_id;\\r\\n\\r\\n  if isadmin is distinct from true then\\r\\n    raise exception 'admin only';\\r\\n  end if;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"change_user_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.change_user_pin(p_user_id uuid, p_old_pin text, p_new_pin text)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  -- basic validation\\r\\n  if p_old_pin !~ '^\\\\d{4}$' or p_new_pin !~ '^\\\\d{4}$' then\\r\\n    raise exception 'PIN must be 4 digits';\\r\\n  end if;\\r\\n\\r\\n  -- verify old pin\\r\\n  if not exists (\\r\\n    select 1\\r\\n    from public.users u\\r\\n    where u.id = p_user_id\\r\\n      and u.pin_hash = crypt(p_old_pin, u.pin_hash)\\r\\n  ) then\\r\\n    raise exception 'Wrong PIN';\\r\\n  end if;\\r\\n\\r\\n  -- set new pin hash\\r\\n  update public.users\\r\\n  set pin_hash = crypt(p_new_pin, gen_salt('bf'))\\r\\n  where id = p_user_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_old_pin text, p_new_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"clear_request_cell\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.clear_request_cell(p_user_id uuid, p_pin text, p_date date)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not exists (\\r\\n    select 1\\r\\n    from public.users\\r\\n    where id = p_user_id\\r\\n      and pin_hash = crypt(p_pin, pin_hash)\\r\\n      and is_active = true\\r\\n  ) then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  --  Block clears if this cell is locked (staff only)\\r\\n  if exists (\\r\\n    select 1\\r\\n    from public.request_cell_locks\\r\\n    where user_id = p_user_id\\r\\n      and date = p_date\\r\\n  ) then\\r\\n    raise exception 'Cell is locked';\\r\\n  end if;\\r\\n\\r\\n  delete from public.requests\\r\\n  where user_id = p_user_id\\r\\n    and date = p_date;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_date date\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"clear_request_with_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.clear_request_with_pin(p_user_id uuid, p_pin text, p_date date)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\nbegin\\r\\n  select public.verify_user_pin(p_user_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'invalid_pin';\\r\\n  end if;\\r\\n\\r\\n  delete from public.requests\\r\\n  where user_id = p_user_id and date = p_date;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_date date\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"crypt\",\n            \"schema\": \"public\",\n            \"returns\": \"text\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.crypt(p_password text, p_salt text)\\n RETURNS text\\n LANGUAGE sql\\n IMMUTABLE\\nAS $function$\\r\\n  select extensions.crypt(p_password, p_salt);\\r\\n$function$\\n\",\n            \"identity_args\": \"p_password text, p_salt text\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"delete_request_with_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.delete_request_with_pin(p_user_id uuid, p_pin text, p_date date)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\nbegin\\r\\n  select public.verify_user_pin(p_user_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'invalid_pin';\\r\\n  end if;\\r\\n\\r\\n  delete from public.requests\\r\\n  where user_id = p_user_id and date = p_date;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_date date\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"enforce_max_5_requests_per_week\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.enforce_max_5_requests_per_week()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nDECLARE\\r\\n  v_count INT;\\r\\n  v_week_start DATE;\\r\\n  v_week_end DATE;\\r\\nBEGIN\\r\\n  -- Calculate week boundaries (Sunday to Saturday)\\r\\n  v_week_start := NEW.date - (EXTRACT(DOW FROM NEW.date)::INT);\\r\\n  v_week_end := v_week_start + 6;\\r\\n\\r\\n  -- Count requests THIS WEEK for this user, EXCLUDING the current date\\r\\n  -- This allows editing existing requests without hitting the limit\\r\\n  SELECT COUNT(*) INTO v_count\\r\\n  FROM requests\\r\\n  WHERE user_id = NEW.user_id\\r\\n    AND date >= v_week_start\\r\\n    AND date <= v_week_end\\r\\n    AND date != NEW.date;  -- Exclude current date to allow edits\\r\\n\\r\\n  -- Only block if we're at 5 requests AND this is a new date (not an edit)\\r\\n  IF v_count >= 5 THEN\\r\\n    -- Check if this date already exists (i.e., this is an edit/update)\\r\\n    IF NOT EXISTS (\\r\\n      SELECT 1 FROM requests WHERE user_id = NEW.user_id AND date = NEW.date\\r\\n    ) THEN\\r\\n      -- This is a NEW request, and we're already at 5 - block it\\r\\n      RAISE EXCEPTION 'Max 5 requests per week';\\r\\n    END IF;\\r\\n    -- If the date exists, this is an edit - allow it\\r\\n  END IF;\\r\\n\\r\\n  -- Allow the insert/update to proceed\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"enforce_off_priority_rules\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.enforce_off_priority_rules()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\ndeclare\\r\\n  v_week_id uuid;\\r\\n  v_rank int;\\r\\n  v_rank_count int;\\r\\n  v_total int;\\r\\nbegin\\r\\n  if new.value is distinct from 'O' then\\r\\n    new.important_rank := null;\\r\\n    return new;\\r\\n  end if;\\r\\n\\r\\n  if new.important_rank is null then\\r\\n    return new;\\r\\n  end if;\\r\\n\\r\\n  if new.important_rank not in (1,2,3) then\\r\\n    raise exception 'OFF priority must be 1, 2, or 3';\\r\\n  end if;\\r\\n\\r\\n  select rd.week_id into v_week_id\\r\\n  from rota_dates rd\\r\\n  where rd.date = new.date;\\r\\n\\r\\n  if v_week_id is null then\\r\\n    raise exception 'No rota week for date %', new.date;\\r\\n  end if;\\r\\n\\r\\n  v_rank := new.important_rank;\\r\\n\\r\\n  select count(*) into v_rank_count\\r\\n  from requests r\\r\\n  join rota_dates rd on rd.date = r.date\\r\\n  where r.user_id = new.user_id\\r\\n    and rd.week_id = v_week_id\\r\\n    and r.value = 'O'\\r\\n    and r.important_rank = v_rank\\r\\n    and not (r.user_id = new.user_id and r.date = new.date);\\r\\n\\r\\n  if v_rank_count >= 1 then\\r\\n    raise exception 'OFF priority % already used this week', v_rank;\\r\\n  end if;\\r\\n\\r\\n  select count(*) into v_total\\r\\n  from requests r\\r\\n  join rota_dates rd on rd.date = r.date\\r\\n  where r.user_id = new.user_id\\r\\n    and rd.week_id = v_week_id\\r\\n    and r.value = 'O'\\r\\n    and r.important_rank in (1,2,3)\\r\\n    and not (r.user_id = new.user_id and r.date = new.date);\\r\\n\\r\\n  if v_total >= 3 then\\r\\n    raise exception 'Max 3 priority OFF requests per week';\\r\\n  end if;\\r\\n\\r\\n  return new;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"gen_salt\",\n            \"schema\": \"public\",\n            \"returns\": \"text\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.gen_salt(p_type text)\\n RETURNS text\\n LANGUAGE sql\\n IMMUTABLE\\nAS $function$\\r\\n  select extensions.gen_salt(p_type);\\r\\n$function$\\n\",\n            \"identity_args\": \"p_type text\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"gen_salt\",\n            \"schema\": \"public\",\n            \"returns\": \"text\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.gen_salt(p_type text, p_rounds integer)\\n RETURNS text\\n LANGUAGE sql\\n IMMUTABLE\\nAS $function$\\r\\n  select extensions.gen_salt(p_type, p_rounds);\\r\\n$function$\\n\",\n            \"identity_args\": \"p_type text, p_rounds integer\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"get_all_notices\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, created_at timestamp with time zone, updated_at timestamp with time zone, title text, body_en text, body_es text, target_role_id integer, acknowledged boolean, acknowledged_at timestamp with time zone)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.get_all_notices(p_user_id uuid, p_pin text)\\n RETURNS TABLE(id uuid, created_at timestamp with time zone, updated_at timestamp with time zone, title text, body_en text, body_es text, target_role_id integer, acknowledged boolean, acknowledged_at timestamp with time zone)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_user public.users;\\r\\nbegin\\r\\n  select *\\r\\n    into v_user\\r\\n  from public.users\\r\\n  where id = p_user_id\\r\\n    and pin_hash = crypt(p_pin, pin_hash)\\r\\n    and is_active = true;\\r\\n\\r\\n  if not found then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  return query\\r\\n  select\\r\\n    n.id, n.created_at, n.updated_at, n.title, n.body_en, n.body_es, n.target_role_id,\\r\\n    (a.user_id is not null) as acknowledged,\\r\\n    a.acknowledged_at\\r\\n  from public.notices n\\r\\n  left join public.notice_ack a\\r\\n    on a.notice_id = n.id\\r\\n   and a.user_id = v_user.id\\r\\n  where n.is_active = true\\r\\n    and (n.target_role_id is null or n.target_role_id = v_user.role_id)\\r\\n  order by n.created_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"get_notices_for_user\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, title text, body_en text, body_es text, version integer, is_active boolean, created_at timestamp with time zone, updated_at timestamp with time zone, created_by uuid, created_by_name text)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.get_notices_for_user(p_user_id uuid, p_pin text)\\n RETURNS TABLE(id uuid, title text, body_en text, body_es text, version integer, is_active boolean, created_at timestamp with time zone, updated_at timestamp with time zone, created_by uuid, created_by_name text)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_role integer;\\r\\nbegin\\r\\n  -- validate user + pin and grab role\\r\\n  select u.role into v_role\\r\\n  from public.users u\\r\\n  where u.id = p_user_id\\r\\n    and u.pin = p_pin;\\r\\n\\r\\n  if v_role is null then\\r\\n    raise exception 'Not authorized';\\r\\n  end if;\\r\\n\\r\\n  -- return notices targeted to everyone OR to the user's role\\r\\n  return query\\r\\n  select\\r\\n    n.id,\\r\\n    n.title,\\r\\n    n.body_en,\\r\\n    n.body_es,\\r\\n    n.version,\\r\\n    n.is_active,\\r\\n    n.created_at,\\r\\n    n.updated_at,\\r\\n    n.created_by,\\r\\n    cu.name as created_by_name\\r\\n  from public.notices n\\r\\n  left join public.users cu on cu.id = n.created_by\\r\\n  where n.is_active = true\\r\\n    and (\\r\\n      n.target_all = true\\r\\n      or (n.target_roles is not null and v_role = any(n.target_roles))\\r\\n    )\\r\\n  order by n.created_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"get_notices_for_user\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, title text, body_en text, body_es text, version integer, is_active boolean, updated_at timestamp with time zone, created_by uuid, created_by_name text, target_all boolean, target_roles integer[], acknowledged_at timestamp with time zone, ack_version integer)\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.get_notices_for_user(p_user_id uuid)\\n RETURNS TABLE(id uuid, title text, body_en text, body_es text, version integer, is_active boolean, updated_at timestamp with time zone, created_by uuid, created_by_name text, target_all boolean, target_roles integer[], acknowledged_at timestamp with time zone, ack_version integer)\\n LANGUAGE sql\\n STABLE SECURITY DEFINER\\nAS $function$\\r\\n  with u as (\\r\\n    select role_id from public.users where id = p_user_id\\r\\n  )\\r\\n  select\\r\\n    n.id,\\r\\n    n.title,\\r\\n    n.body_en,\\r\\n    n.body_es,\\r\\n    n.version,\\r\\n    n.is_active,\\r\\n    n.updated_at,\\r\\n    n.created_by,\\r\\n    u2.name as created_by_name,\\r\\n    n.target_all,\\r\\n    n.target_roles,\\r\\n    a.acknowledged_at,\\r\\n    a.version as ack_version\\r\\n  from public.notices n\\r\\n  cross join u\\r\\n  left join public.users u2 on u2.id = n.created_by\\r\\n  left join public.notice_ack a on a.notice_id = n.id and a.user_id = p_user_id\\r\\n  where n.is_active = true\\r\\n    and (\\r\\n      coalesce(n.target_all, true) = true\\r\\n      or (\\r\\n        u.role_id is not null\\r\\n        and n.target_roles is not null\\r\\n        and (u.role_id::int = any(n.target_roles))\\r\\n      )\\r\\n    )\\r\\n  order by n.updated_at desc;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"get_pending_swap_requests_for_me\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, initiator_name text, counterparty_name text, initiator_shift_date date, initiator_shift_code text, counterparty_shift_date date, counterparty_shift_code text, created_at timestamp with time zone)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.get_pending_swap_requests_for_me(p_user_id uuid)\\n RETURNS TABLE(id uuid, initiator_name text, counterparty_name text, initiator_shift_date date, initiator_shift_code text, counterparty_shift_date date, counterparty_shift_code text, created_at timestamp with time zone)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  return query\\r\\n  select sr.id,\\r\\n    u1.name as initiator_name, u2.name as counterparty_name,\\r\\n    sr.initiator_shift_date, sr.initiator_shift_code,\\r\\n    sr.counterparty_shift_date, sr.counterparty_shift_code,\\r\\n    sr.created_at\\r\\n  from swap_requests sr\\r\\n  join public.users u1 on u1.id = sr.initiator_user_id\\r\\n  join public.users u2 on u2.id = sr.counterparty_user_id\\r\\n  where sr.counterparty_user_id = p_user_id\\r\\n    and sr.status = 'pending'\\r\\n    and sr.counterparty_response is null\\r\\n  order by sr.created_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"get_unread_notices\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(id uuid, created_at timestamp with time zone, updated_at timestamp with time zone, title text, body_en text, body_es text, target_role_id integer)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.get_unread_notices(p_user_id uuid, p_pin text)\\n RETURNS TABLE(id uuid, created_at timestamp with time zone, updated_at timestamp with time zone, title text, body_en text, body_es text, target_role_id integer)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_user public.users;\\r\\nbegin\\r\\n  select *\\r\\n    into v_user\\r\\n  from public.users\\r\\n  where id = p_user_id\\r\\n    and pin_hash = crypt(p_pin, pin_hash)\\r\\n    and is_active = true;\\r\\n\\r\\n  if not found then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  return query\\r\\n  select n.id, n.created_at, n.updated_at, n.title, n.body_en, n.body_es, n.target_role_id\\r\\n  from public.notices n\\r\\n  where n.is_active = true\\r\\n    and (n.target_role_id is null or n.target_role_id = v_user.role_id)\\r\\n    and not exists (\\r\\n      select 1\\r\\n      from public.notice_ack a\\r\\n      where a.notice_id = n.id\\r\\n        and a.user_id = v_user.id\\r\\n    )\\r\\n  order by n.created_at desc;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"get_week_comments\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(user_id uuid, user_name text, comment text, updated_at timestamp with time zone)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.get_week_comments(p_week_id uuid, p_user_id uuid, p_pin text)\\n RETURNS TABLE(user_id uuid, user_name text, comment text, updated_at timestamp with time zone)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\n  isadmin boolean;\\r\\nbegin\\r\\n  select public.verify_user_pin(p_user_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'bad pin';\\r\\n  end if;\\r\\n\\r\\n  select u.is_admin into isadmin\\r\\n  from public.users u\\r\\n  where u.id = p_user_id;\\r\\n\\r\\n  if isadmin then\\r\\n    return query\\r\\n      select wc.user_id, u.name, wc.comment, wc.updated_at\\r\\n      from public.week_comments wc\\r\\n      join public.users u on u.id = wc.user_id\\r\\n      where wc.week_id = p_week_id\\r\\n      order by u.name;\\r\\n  else\\r\\n    return query\\r\\n      select wc.user_id, u.name, wc.comment, wc.updated_at\\r\\n      from public.week_comments wc\\r\\n      join public.users u on u.id = wc.user_id\\r\\n      where wc.week_id = p_week_id\\r\\n        and wc.user_id = p_user_id\\r\\n      limit 1;\\r\\n  end if;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_week_id uuid, p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"is_admin\",\n            \"schema\": \"public\",\n            \"returns\": \"boolean\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.is_admin()\\n RETURNS boolean\\n LANGUAGE sql\\n STABLE SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\n  select exists (\\r\\n    select 1\\r\\n    from public.users u\\r\\n    where u.id = auth.uid()\\r\\n      and u.is_admin = true\\r\\n  );\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"is_admin_user\",\n            \"schema\": \"public\",\n            \"returns\": \"boolean\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.is_admin_user(p_user_id uuid)\\n RETURNS boolean\\n LANGUAGE sql\\n STABLE\\nAS $function$\\r\\n  select coalesce((select is_admin from public.users where id = p_user_id), false);\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"log_rota_assignment_audit\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.log_rota_assignment_audit(p_period_id uuid, p_user_id uuid, p_date date, p_old_shift_id bigint, p_new_shift_id bigint, p_action_type text, p_changed_by uuid, p_comment text DEFAULT NULL::text)\\n RETURNS void\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  IF p_action_type NOT IN ('change', 'clear', 'override') THEN\\r\\n    RAISE EXCEPTION 'Invalid action_type: %', p_action_type;\\r\\n  END IF;\\r\\n\\r\\n  INSERT INTO public.rota_assignment_audits (\\r\\n    period_id, user_id, date, old_shift_id, new_shift_id, action_type, changed_by, comment\\r\\n  ) VALUES (\\r\\n    p_period_id, p_user_id, p_date, p_old_shift_id, p_new_shift_id, p_action_type, p_changed_by, p_comment\\r\\n  );\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_period_id uuid, p_user_id uuid, p_date date, p_old_shift_id bigint, p_new_shift_id bigint, p_action_type text, p_changed_by uuid, p_comment text\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"notifications_set_updated_at\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.notifications_set_updated_at()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  NEW.updated_at := now();\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"save_request_with_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"requests\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.save_request_with_pin(p_user_id uuid, p_pin text, p_date date, p_value text, p_important_rank integer)\\n RETURNS requests\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\n  r public.requests;\\r\\nbegin\\r\\n  select public.verify_user_pin(p_user_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'invalid_pin';\\r\\n  end if;\\r\\n\\r\\n  insert into public.requests(user_id, date, value, important_rank)\\r\\n  values (p_user_id, p_date, nullif(p_value,''), p_important_rank)\\r\\n  on conflict (user_id, date)\\r\\n  do update set\\r\\n    value = excluded.value,\\r\\n    important_rank = excluded.important_rank\\r\\n  returning * into r;\\r\\n\\r\\n  return r;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_date date, p_value text, p_important_rank integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_comment_created_audit\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_comment_created_audit()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  -- Only set created_by if not already provided by the application\\r\\n  IF NEW.created_by IS NULL THEN\\r\\n    NEW.created_by := auth.uid();\\r\\n  END IF;\\r\\n  \\r\\n  -- Always set updated_by\\r\\n  NEW.updated_by := COALESCE(auth.uid(), NEW.created_by);\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"set_comment_updated_audit\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_comment_updated_audit()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  NEW.updated_by := auth.uid();\\r\\n  NEW.updated_at := NOW();\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"set_override_created_audit\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_override_created_audit()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  NEW.created_by := auth.uid();\\r\\n  NEW.updated_by := auth.uid();\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"set_override_updated_audit\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_override_updated_audit()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  NEW.updated_by := auth.uid();\\r\\n  NEW.updated_at := NOW();\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"set_request_cell\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(out_id uuid, out_user_id uuid, out_date date, out_value text, out_important_rank smallint)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_request_cell(p_user_id uuid, p_pin text, p_date date, p_value text, p_important_rank smallint DEFAULT NULL::smallint)\\n RETURNS TABLE(out_id uuid, out_user_id uuid, out_date date, out_value text, out_important_rank smallint)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nDECLARE\\r\\n  v_pin_hash TEXT;\\r\\n  v_count INT;\\r\\n  v_week_start DATE;\\r\\n  v_week_end DATE;\\r\\nBEGIN\\r\\n  -- Verify PIN\\r\\n  SELECT pin_hash INTO v_pin_hash FROM users WHERE users.id = p_user_id;\\r\\n  IF v_pin_hash IS NULL OR v_pin_hash != crypt(p_pin, v_pin_hash) THEN\\r\\n    RAISE EXCEPTION 'Invalid PIN';\\r\\n  END IF;\\r\\n\\r\\n  -- Calculate week boundaries (Sunday to Saturday)\\r\\n  v_week_start := p_date - (EXTRACT(DOW FROM p_date)::INT);\\r\\n  v_week_end := v_week_start + 6;\\r\\n\\r\\n  --  FIX: Count requests THIS WEEK, EXCLUDING the current date being edited\\r\\n  SELECT COUNT(*) INTO v_count\\r\\n  FROM requests\\r\\n  WHERE requests.user_id = p_user_id\\r\\n    AND requests.date >= v_week_start\\r\\n    AND requests.date <= v_week_end\\r\\n    AND requests.date != p_date;  --  KEY FIX: exclude current date\\r\\n\\r\\n  -- Only block if we're at 5 AND this is a NEW request (not an edit)\\r\\n  IF v_count >= 5 AND NOT EXISTS (\\r\\n    SELECT 1 FROM requests WHERE requests.user_id = p_user_id AND requests.date = p_date\\r\\n  ) THEN\\r\\n    RAISE EXCEPTION 'Max 5 requests per week';\\r\\n  END IF;\\r\\n\\r\\n  -- Upsert the request\\r\\n  RETURN QUERY\\r\\n  INSERT INTO requests (user_id, date, value, important_rank)\\r\\n  VALUES (p_user_id, p_date, p_value, p_important_rank)\\r\\n  ON CONFLICT (user_id, date) \\r\\n  DO UPDATE SET \\r\\n    value = EXCLUDED.value,\\r\\n    important_rank = EXCLUDED.important_rank,\\r\\n    updated_at = NOW()\\r\\n  RETURNING \\r\\n    requests.id AS out_id,\\r\\n    requests.user_id AS out_user_id,\\r\\n    requests.date AS out_date,\\r\\n    requests.value AS out_value,\\r\\n    requests.important_rank AS out_important_rank;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_date date, p_value text, p_important_rank smallint\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_user_active\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_user_active(p_admin_id uuid, p_pin text, p_user_id uuid, p_active boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not verify_admin_pin(p_admin_id, p_pin) then\\r\\n    raise exception 'Not authorized';\\r\\n  end if;\\r\\n\\r\\n  update users\\r\\n  set is_active = p_active\\r\\n  where id = p_user_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text, p_user_id uuid, p_active boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_user_active\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_user_active(p_user_id uuid, p_active boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nBEGIN\\r\\n  IF NOT EXISTS (\\r\\n    SELECT 1 FROM public.users\\r\\n    WHERE id = auth.uid()\\r\\n      AND is_admin = true\\r\\n  ) THEN\\r\\n    RAISE EXCEPTION 'Not authorized';\\r\\n  END IF;\\r\\n\\r\\n  UPDATE public.users\\r\\n  SET is_active = p_active\\r\\n  WHERE id = p_user_id;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_active boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_user_admin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_user_admin(p_user_id uuid, p_admin boolean)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nBEGIN\\r\\n  IF NOT EXISTS (\\r\\n    SELECT 1 FROM public.users\\r\\n    WHERE id = auth.uid()\\r\\n      AND is_admin = true\\r\\n  ) THEN\\r\\n    RAISE EXCEPTION 'Not authorized';\\r\\n  END IF;\\r\\n\\r\\n  UPDATE public.users\\r\\n  SET is_admin = p_admin\\r\\n  WHERE id = p_user_id;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_admin boolean\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_user_language\",\n            \"schema\": \"public\",\n            \"returns\": \"text\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_user_language(p_user_id uuid, p_pin text, p_lang text)\\n RETURNS text\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if not exists (\\r\\n    select 1\\r\\n    from public.users u\\r\\n    where u.id = p_user_id\\r\\n      and u.pin_hash = crypt(p_pin, u.pin_hash)\\r\\n  ) then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  if p_lang not in ('en','es') then\\r\\n    raise exception 'Invalid language';\\r\\n  end if;\\r\\n\\r\\n  update public.users\\r\\n  set preferred_lang = p_lang\\r\\n  where id = p_user_id;\\r\\n\\r\\n  return p_lang;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_lang text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_user_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"void\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_user_pin(p_user_id uuid, p_pin text)\\n RETURNS void\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if p_pin is null or p_pin !~ '^\\\\d{4}$' then\\r\\n    raise exception 'PIN must be 4 digits';\\r\\n  end if;\\r\\n\\r\\n  update public.users\\r\\n  set pin_hash = crypt(p_pin, gen_salt('bf'))\\r\\n  where id = p_user_id;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"set_week_comments_updated_at\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.set_week_comments_updated_at()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nbegin\\r\\n  new.updated_at = now();\\r\\n  return new;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"staff_request_shift_swap\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(success boolean, swap_request_id uuid, error_message text)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.staff_request_shift_swap(p_user_id uuid, p_initiator_shift_date date, p_counterparty_user_id uuid, p_counterparty_shift_date date, p_period_id integer DEFAULT NULL::integer)\\n RETURNS TABLE(success boolean, swap_request_id uuid, error_message text)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_swap_req_id uuid;\\r\\n  v_initiator_week_id integer;\\r\\n  v_counterparty_week_id integer;\\r\\n  v_debug_user_count integer;\\r\\n  v_debug_user_active boolean;\\r\\nbegin\\r\\n  -- Debug: Check if user exists in public.users\\r\\n  select count(*), bool_or(is_active) into v_debug_user_count, v_debug_user_active\\r\\n  from public.users where id = p_user_id;\\r\\n  \\r\\n  if v_debug_user_count = 0 then\\r\\n    return query select false, null::uuid, format('DEBUG: User %s not found in public.users table', p_user_id)::text;\\r\\n    return;\\r\\n  end if;\\r\\n  \\r\\n  if not v_debug_user_active then\\r\\n    return query select false, null::uuid, format('DEBUG: User %s exists but is_active=false', p_user_id)::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Verify counterparty exists\\r\\n  select count(*), bool_or(is_active) into v_debug_user_count, v_debug_user_active\\r\\n  from public.users where id = p_counterparty_user_id;\\r\\n  \\r\\n  if v_debug_user_count = 0 then\\r\\n    return query select false, null::uuid, format('DEBUG: Counterparty %s not found in public.users table', p_counterparty_user_id)::text;\\r\\n    return;\\r\\n  end if;\\r\\n  \\r\\n  if not v_debug_user_active then\\r\\n    return query select false, null::uuid, format('DEBUG: Counterparty %s exists but is_active=false', p_counterparty_user_id)::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Verify shifts exist\\r\\n  if not exists(\\r\\n    select 1 from rota_assignments ra\\r\\n    join shifts s on s.id = ra.shift_id\\r\\n    where ra.user_id = p_user_id and ra.date = p_initiator_shift_date and s.code != 'O'\\r\\n  ) then\\r\\n    return query select false, null::uuid, 'Your shift on this date not found'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  if not exists(\\r\\n    select 1 from rota_assignments ra\\r\\n    join shifts s on s.id = ra.shift_id\\r\\n    where ra.user_id = p_counterparty_user_id and ra.date = p_counterparty_shift_date and s.code != 'O'\\r\\n  ) then\\r\\n    return query select false, null::uuid, 'Peer shift on this date not found'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  -- Defer FK constraint checks to end of transaction\\r\\n  set constraints all deferred;\\r\\n\\r\\n  -- Create swap request\\r\\n  insert into swap_requests(\\r\\n    period_id, initiator_user_id, counterparty_user_id,\\r\\n    initiator_shift_date, initiator_shift_code, initiator_week_id,\\r\\n    counterparty_shift_date, counterparty_shift_code, counterparty_week_id,\\r\\n    status\\r\\n  )\\r\\n  select\\r\\n    p_period_id, p_user_id, p_counterparty_user_id,\\r\\n    p_initiator_shift_date, s1.code, null::integer,\\r\\n    p_counterparty_shift_date, s2.code, null::integer,\\r\\n    'pending'\\r\\n  from (\\r\\n    select s.code from rota_assignments ra\\r\\n    join shifts s on s.id = ra.shift_id\\r\\n    where ra.user_id = p_user_id and ra.date = p_initiator_shift_date\\r\\n    limit 1\\r\\n  ) s1\\r\\n  cross join (\\r\\n    select s.code from rota_assignments ra\\r\\n    join shifts s on s.id = ra.shift_id\\r\\n    where ra.user_id = p_counterparty_user_id and ra.date = p_counterparty_shift_date\\r\\n    limit 1\\r\\n  ) s2\\r\\n  returning id into v_swap_req_id;\\r\\n\\r\\n  -- Restore immediate constraint checking\\r\\n  set constraints all immediate;\\r\\n\\r\\n  return query select true, v_swap_req_id, null::text;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_initiator_shift_date date, p_counterparty_user_id uuid, p_counterparty_shift_date date, p_period_id integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"staff_respond_to_swap_request\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(success boolean, error_message text)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.staff_respond_to_swap_request(p_user_id uuid, p_swap_request_id uuid, p_response text)\\n RETURNS TABLE(success boolean, error_message text)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\nbegin\\r\\n  if p_response not in ('accepted', 'declined', 'ignored') then\\r\\n    return query select false, 'Invalid response. Must be: accepted, declined, or ignored'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  if not exists(select 1 from swap_requests where id = p_swap_request_id and counterparty_user_id = p_user_id) then\\r\\n    return query select false, 'Swap request not found or you are not the counterparty'::text;\\r\\n    return;\\r\\n  end if;\\r\\n\\r\\n  update swap_requests\\r\\n    set counterparty_response = p_response,\\r\\n        counterparty_responded_at = now(),\\r\\n        status = case\\r\\n          when p_response = 'accepted' then 'accepted_by_counterparty'\\r\\n          when p_response = 'declined' then 'declined_by_counterparty'\\r\\n          when p_response = 'ignored' then 'ignored'\\r\\n          else status\\r\\n        end\\r\\n    where id = p_swap_request_id;\\r\\n\\r\\n  return query select true, null::text;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_swap_request_id uuid, p_response text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"touch_notice_updated_at\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.touch_notice_updated_at()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nbegin\\r\\n  new.updated_at = now();\\r\\n  return new;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"touch_updated_at\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.touch_updated_at()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nbegin\\r\\n  new.updated_at = now();\\r\\n  return new;\\r\\nend; $function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"update_staffing_requirements_updated_at\",\n            \"schema\": \"public\",\n            \"returns\": \"trigger\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.update_staffing_requirements_updated_at()\\n RETURNS trigger\\n LANGUAGE plpgsql\\nAS $function$\\r\\nBEGIN\\r\\n  NEW.updated_at = NOW();\\r\\n  RETURN NEW;\\r\\nEND;\\r\\n$function$\\n\",\n            \"identity_args\": \"\",\n            \"security_definer\": false\n        },\n        {\n            \"name\": \"upsert_request_with_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"requests\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.upsert_request_with_pin(p_user_id uuid, p_pin text, p_date date, p_value text, p_important_rank integer DEFAULT NULL::integer)\\n RETURNS requests\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\n SET search_path TO 'public'\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\n  row public.requests;\\r\\nbegin\\r\\n  -- verify pin (you already have verify_user_pin RPC)\\r\\n  select public.verify_user_pin(p_user_id, p_pin) into ok;\\r\\n  if ok is distinct from true then\\r\\n    raise exception 'invalid_pin';\\r\\n  end if;\\r\\n\\r\\n  insert into public.requests (user_id, date, value, important_rank)\\r\\n  values (p_user_id, p_date, nullif(p_value,''), p_important_rank)\\r\\n  on conflict (user_id, date)\\r\\n  do update set\\r\\n    value = excluded.value,\\r\\n    important_rank = excluded.important_rank\\r\\n  returning * into row;\\r\\n\\r\\n  return row;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text, p_date date, p_value text, p_important_rank integer\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"upsert_week_comment\",\n            \"schema\": \"public\",\n            \"returns\": \"week_comments\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.upsert_week_comment(p_week_id uuid, p_user_id uuid, p_pin text, p_comment text)\\n RETURNS week_comments\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_user public.users;\\r\\n  v_row public.week_comments;\\r\\nbegin\\r\\n  -- verify user + PIN\\r\\n  select *\\r\\n  into v_user\\r\\n  from public.users\\r\\n  where id = p_user_id\\r\\n    and pin_hash = crypt(p_pin, pin_hash)\\r\\n    and is_active = true;\\r\\n\\r\\n  if not found then\\r\\n    raise exception 'Invalid PIN';\\r\\n  end if;\\r\\n\\r\\n  insert into public.week_comments (week_id, user_id, comment)\\r\\n  values (p_week_id, p_user_id, p_comment)\\r\\n  on conflict (week_id, user_id)\\r\\n  do update set\\r\\n    comment = excluded.comment,\\r\\n    updated_at = now()\\r\\n  returning * into v_row;\\r\\n\\r\\n  return v_row;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_week_id uuid, p_user_id uuid, p_pin text, p_comment text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"verify_admin_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"boolean\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.verify_admin_pin(p_admin_id uuid, p_pin text)\\n RETURNS boolean\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  ok boolean;\\r\\nbegin\\r\\n  select true\\r\\n  into ok\\r\\n  from users\\r\\n  where id = p_admin_id\\r\\n    and is_admin = true\\r\\n    and pin_hash = crypt(p_pin, pin_hash);\\r\\n\\r\\n  return coalesce(ok, false);\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_admin_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"verify_pin_login\",\n            \"schema\": \"public\",\n            \"returns\": \"TABLE(token uuid, user_id uuid, name text, role_id smallint, is_admin boolean)\",\n            \"language\": \"plpgsql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.verify_pin_login(p_user_id uuid, p_pin text)\\n RETURNS TABLE(token uuid, user_id uuid, name text, role_id smallint, is_admin boolean)\\n LANGUAGE plpgsql\\n SECURITY DEFINER\\nAS $function$\\r\\ndeclare\\r\\n  v_user public.users%rowtype;\\r\\n  v_token uuid;\\r\\nbegin\\r\\n  -- Find the user\\r\\n  select * into v_user\\r\\n  from public.users\\r\\n  where id = p_user_id;\\r\\n\\r\\n  if not found then\\r\\n    raise exception 'user not found';\\r\\n  end if;\\r\\n\\r\\n  -- Must have a pin_hash set\\r\\n  if v_user.pin_hash is null then\\r\\n    raise exception 'pin not set';\\r\\n  end if;\\r\\n\\r\\n  -- Verify PIN using crypt(): crypt(pin, stored_hash) = stored_hash\\r\\n  if crypt(p_pin, v_user.pin_hash) <> v_user.pin_hash then\\r\\n    raise exception 'invalid pin';\\r\\n  end if;\\r\\n\\r\\n  -- Create session token (8 hours)\\r\\n  insert into public.sessions (user_id, expires_at)\\r\\n  values (v_user.id, now() + interval '8 hours')\\r\\n  returning sessions.token into v_token;\\r\\n\\r\\n  -- Return token + user info\\r\\n  token := v_token;\\r\\n  user_id := v_user.id;\\r\\n  name := v_user.name;\\r\\n  role_id := v_user.role_id;\\r\\n  is_admin := v_user.is_admin;\\r\\n  return next;\\r\\nend;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        },\n        {\n            \"name\": \"verify_user_pin\",\n            \"schema\": \"public\",\n            \"returns\": \"boolean\",\n            \"language\": \"sql\",\n            \"definition\": \"CREATE OR REPLACE FUNCTION public.verify_user_pin(p_user_id uuid, p_pin text)\\n RETURNS boolean\\n LANGUAGE sql\\n SECURITY DEFINER\\nAS $function$\\r\\n  select pin_hash = crypt(p_pin, pin_hash)\\r\\n  from public.users\\r\\n  where id = p_user_id;\\r\\n$function$\\n\",\n            \"identity_args\": \"p_user_id uuid, p_pin text\",\n            \"security_definer\": true\n        }\n    ],\n    \"rls_tables\": [\n        {\n            \"table\": \"admin_pins\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"app_settings\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"notice_ack\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"notice_targets\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"notices\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"notifications\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"pattern_definitions\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"permission_group_permissions\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"permission_groups\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"permissions\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"planned_assignments\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"request_cell_locks\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"requests\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"roles\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"rota_assignment_audits\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"rota_assignment_comments\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"rota_assignment_overrides\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"rota_assignments\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"rota_dates\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"rota_periods\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"rota_weeks\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"sessions\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"shift_catalogue\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"shift_eligibility\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"shifts\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"staffing_requirements\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        },\n        {\n            \"table\": \"swap_executions\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"swap_requests\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"user_patterns\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"user_permission_groups\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"users\",\n            \"rls_forced\": false,\n            \"rls_enabled\": false\n        },\n        {\n            \"table\": \"week_comments\",\n            \"rls_forced\": false,\n            \"rls_enabled\": true\n        }\n    ],\n    \"constraints\": [\n        {\n            \"name\": \"2200_34802_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"admin_pins\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34802_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"admin_pins\",\n            \"column\": null,\n            \"check_clause\": \"pin IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"admin_pins_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"admin_pins\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"admin_pins\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"admin_pins_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"admin_pins\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_22564_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"app_settings\",\n            \"column\": null,\n            \"check_clause\": \"key IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_22564_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"app_settings\",\n            \"column\": null,\n            \"check_clause\": \"value IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"app_settings_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"app_settings\",\n            \"column\": \"key\",\n            \"check_clause\": null,\n            \"foreign_table\": \"app_settings\",\n            \"foreign_column\": \"key\"\n        },\n        {\n            \"name\": \"2200_23720_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notice_ack\",\n            \"column\": null,\n            \"check_clause\": \"notice_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23720_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notice_ack\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23720_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notice_ack\",\n            \"column\": null,\n            \"check_clause\": \"acknowledged_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23720_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notice_ack\",\n            \"column\": null,\n            \"check_clause\": \"version IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"notice_ack_notice_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"notice_ack\",\n            \"column\": \"notice_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notices\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"notice_ack_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_ack\",\n            \"column\": \"notice_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_ack\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"notice_ack_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_ack\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_ack\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"notice_ack_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_ack\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_ack\",\n            \"foreign_column\": \"notice_id\"\n        },\n        {\n            \"name\": \"notice_ack_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_ack\",\n            \"column\": \"notice_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_ack\",\n            \"foreign_column\": \"notice_id\"\n        },\n        {\n            \"name\": \"notice_ack_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"notice_ack\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_23744_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notice_targets\",\n            \"column\": null,\n            \"check_clause\": \"notice_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23744_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notice_targets\",\n            \"column\": null,\n            \"check_clause\": \"role_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"notice_targets_notice_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"notice_targets\",\n            \"column\": \"notice_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notices\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"notice_targets_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_targets\",\n            \"column\": \"role_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_targets\",\n            \"foreign_column\": \"role_id\"\n        },\n        {\n            \"name\": \"notice_targets_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_targets\",\n            \"column\": \"notice_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_targets\",\n            \"foreign_column\": \"role_id\"\n        },\n        {\n            \"name\": \"notice_targets_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_targets\",\n            \"column\": \"notice_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_targets\",\n            \"foreign_column\": \"notice_id\"\n        },\n        {\n            \"name\": \"notice_targets_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notice_targets\",\n            \"column\": \"role_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notice_targets\",\n            \"foreign_column\": \"notice_id\"\n        },\n        {\n            \"name\": \"2200_23702_10_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"target_all IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23702_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23702_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23702_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"updated_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23702_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"title IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23702_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"body_en IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23702_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notices\",\n            \"column\": null,\n            \"check_clause\": \"is_active IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"notices_created_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"notices\",\n            \"column\": \"created_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"notices_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notices\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notices\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34715_10_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34715_12_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"updated_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34715_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34715_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"type IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34715_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"target_scope IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34715_7_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"requires_action IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34715_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"status IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"notifications_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"notifications\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"notifications\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"notifications_status_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"(status = ANY (ARRAY['pending'::text, 'ack'::text, 'accepted'::text, 'declined'::text, 'ignored'::text]))\",\n            \"foreign_table\": \"notifications\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"notifications_target_scope_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"notifications\",\n            \"column\": null,\n            \"check_clause\": \"(target_scope = ANY (ARRAY['all_staff'::text, 'role'::text, 'user'::text]))\",\n            \"foreign_table\": \"notifications\",\n            \"foreign_column\": \"target_scope\"\n        },\n        {\n            \"name\": \"2200_33160_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"pattern_definitions\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33160_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"pattern_definitions\",\n            \"column\": null,\n            \"check_clause\": \"name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33160_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"pattern_definitions\",\n            \"column\": null,\n            \"check_clause\": \"cycle_weeks IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33160_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"pattern_definitions\",\n            \"column\": null,\n            \"check_clause\": \"weekly_targets IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33160_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"pattern_definitions\",\n            \"column\": null,\n            \"check_clause\": \"pattern_type IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33160_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"pattern_definitions\",\n            \"column\": null,\n            \"check_clause\": \"requires_anchor IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"pattern_definitions_name_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"name\",\n            \"check_clause\": null,\n            \"foreign_table\": \"pattern_definitions\",\n            \"foreign_column\": \"name\"\n        },\n        {\n            \"name\": \"pattern_definitions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"pattern_definitions\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"pattern_definitions\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_32920_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": null,\n            \"check_clause\": \"group_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32920_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": null,\n            \"check_clause\": \"permission_key IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"permission_group_permissions_group_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"group_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_groups\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"permission_group_permissions_permission_key_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"permission_key\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permissions\",\n            \"foreign_column\": \"key\"\n        },\n        {\n            \"name\": \"permission_group_permissions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"group_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_group_permissions\",\n            \"foreign_column\": \"permission_key\"\n        },\n        {\n            \"name\": \"permission_group_permissions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"group_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_group_permissions\",\n            \"foreign_column\": \"group_id\"\n        },\n        {\n            \"name\": \"permission_group_permissions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"permission_key\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_group_permissions\",\n            \"foreign_column\": \"permission_key\"\n        },\n        {\n            \"name\": \"permission_group_permissions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"permission_group_permissions\",\n            \"column\": \"permission_key\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_group_permissions\",\n            \"foreign_column\": \"group_id\"\n        },\n        {\n            \"name\": \"2200_32900_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32900_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32900_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"is_system IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32900_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"is_protected IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32900_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"permission_groups_name_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"permission_groups\",\n            \"column\": \"name\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_groups\",\n            \"foreign_column\": \"name\"\n        },\n        {\n            \"name\": \"permission_groups_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"permission_groups\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_groups\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_32913_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permissions\",\n            \"column\": null,\n            \"check_clause\": \"key IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32913_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permissions\",\n            \"column\": null,\n            \"check_clause\": \"label IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32913_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"permissions\",\n            \"column\": null,\n            \"check_clause\": \"category IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"permissions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"permissions\",\n            \"column\": \"key\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permissions\",\n            \"foreign_column\": \"key\"\n        },\n        {\n            \"name\": \"2200_34818_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"planned_assignments\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34818_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"planned_assignments\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34818_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"planned_assignments\",\n            \"column\": null,\n            \"check_clause\": \"period_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34818_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"planned_assignments\",\n            \"column\": null,\n            \"check_clause\": \"date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34818_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"planned_assignments\",\n            \"column\": null,\n            \"check_clause\": \"shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"planned_assignments_period_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"planned_assignments_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"planned_assignments_user_id_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"planned_assignments\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"planned_assignments\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"2200_23676_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"request_cell_locks\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23676_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"request_cell_locks\",\n            \"column\": null,\n            \"check_clause\": \"date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23676_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"request_cell_locks\",\n            \"column\": null,\n            \"check_clause\": \"locked_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_23676_7_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"request_cell_locks\",\n            \"column\": null,\n            \"check_clause\": \"updated_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"request_cell_locks_locked_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"locked_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"request_cell_locks_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"request_cell_locks\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"request_cell_locks_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"request_cell_locks\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"request_cell_locks_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"request_cell_locks\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"request_cell_locks_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"request_cell_locks\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"request_cell_locks_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"request_cell_locks\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_17582_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"requests\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"important_only_on_off\",\n            \"type\": \"CHECK\",\n            \"table\": \"requests\",\n            \"column\": null,\n            \"check_clause\": \"((important_rank IS NULL) OR (value = 'O'::text))\",\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"important_rank\"\n        },\n        {\n            \"name\": \"important_only_on_off\",\n            \"type\": \"CHECK\",\n            \"table\": \"requests\",\n            \"column\": null,\n            \"check_clause\": \"((important_rank IS NULL) OR (value = 'O'::text))\",\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"value\"\n        },\n        {\n            \"name\": \"requests_date_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"requests\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_dates\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"requests_important_rank_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"requests\",\n            \"column\": null,\n            \"check_clause\": \"(important_rank = ANY (ARRAY[1, 2, 3]))\",\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"important_rank\"\n        },\n        {\n            \"name\": \"requests_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"requests\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"requests_user_date_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"requests_user_date_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"requests_user_date_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"requests_user_date_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"requests_user_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"requests_user_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"requests_user_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"requests_user_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"requests\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"requests_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"requests\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"requests_value_allowed\",\n            \"type\": \"CHECK\",\n            \"table\": \"requests\",\n            \"column\": null,\n            \"check_clause\": \"(value = ANY (ARRAY['LD'::text, '8-8'::text, 'N'::text, 'W'::text, 'O'::text, 'L'::text]))\",\n            \"foreign_table\": \"requests\",\n            \"foreign_column\": \"value\"\n        },\n        {\n            \"name\": \"2200_17604_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"roles\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17604_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"roles\",\n            \"column\": null,\n            \"check_clause\": \"name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"roles_name_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"roles\",\n            \"column\": \"name\",\n            \"check_clause\": null,\n            \"foreign_table\": \"roles\",\n            \"foreign_column\": \"name\"\n        },\n        {\n            \"name\": \"roles_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"roles\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"roles\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34466_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34466_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"period_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34466_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34466_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34466_7_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"action_type IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34466_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"changed_by IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34466_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"changed_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"rota_assignment_audits_action_type_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": null,\n            \"check_clause\": \"(action_type = ANY (ARRAY['change'::text, 'clear'::text, 'override'::text]))\",\n            \"foreign_table\": \"rota_assignment_audits\",\n            \"foreign_column\": \"action_type\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_changed_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"changed_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_new_shift_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"new_shift_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_old_shift_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"old_shift_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_period_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignment_audits\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_audits_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_audits\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34668_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34668_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": null,\n            \"check_clause\": \"rota_assignment_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34668_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": null,\n            \"check_clause\": \"comment IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"rota_assignment_comments_comment_visibility_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": null,\n            \"check_clause\": \"(comment_visibility = ANY (ARRAY['admin_only'::text, 'all_staff'::text, 'user_only'::text]))\",\n            \"foreign_table\": \"rota_assignment_comments\",\n            \"foreign_column\": \"comment_visibility\"\n        },\n        {\n            \"name\": \"rota_assignment_comments_created_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"created_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_comments_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignment_comments\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_comments_updated_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_comments\",\n            \"column\": \"updated_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34636_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34636_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": null,\n            \"check_clause\": \"rota_assignment_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"rota_assignment_overrides_comment_visibility_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": null,\n            \"check_clause\": \"(comment_visibility = ANY (ARRAY['admin_only'::text, 'all_staff'::text, 'user_only'::text]))\",\n            \"foreign_table\": \"rota_assignment_overrides\",\n            \"foreign_column\": \"comment_visibility\"\n        },\n        {\n            \"name\": \"rota_assignment_overrides_created_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"created_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_overrides_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignment_overrides\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignment_overrides_rota_assignment_id_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"rota_assignment_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignment_overrides\",\n            \"foreign_column\": \"rota_assignment_id\"\n        },\n        {\n            \"name\": \"rota_assignment_overrides_updated_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignment_overrides\",\n            \"column\": \"updated_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_33216_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33216_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33216_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33216_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"shift_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33216_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"status IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33216_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"rota_assignments_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignments_shift_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"shift_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_assignments_status_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_assignments\",\n            \"column\": null,\n            \"check_clause\": \"(status = ANY (ARRAY['draft'::text, 'published'::text]))\",\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"status\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"status\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"status\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"rota_assignments_user_id_date_status_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_assignments\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_assignments\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"2200_17567_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_dates\",\n            \"column\": null,\n            \"check_clause\": \"date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"rota_dates_period_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_dates\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_dates_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_dates\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_dates\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"rota_dates_week_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_dates\",\n            \"column\": \"week_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_17544_11_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"status IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17544_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17544_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17544_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"start_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17544_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"end_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17544_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"is_active IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17544_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"is_hidden IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"chk_rota_periods_status\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"(status = ANY (ARRAY['draft'::text, 'published'::text]))\",\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"rota_periods_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"(end_date = (start_date + '34 days'::interval))\",\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"end_date\"\n        },\n        {\n            \"name\": \"rota_periods_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_periods\",\n            \"column\": null,\n            \"check_clause\": \"(end_date = (start_date + '34 days'::interval))\",\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"start_date\"\n        },\n        {\n            \"name\": \"rota_periods_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_periods\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_periods_published_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_periods\",\n            \"column\": \"published_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_17554_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_weeks\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17554_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_weeks\",\n            \"column\": null,\n            \"check_clause\": \"week_start IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17554_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_weeks\",\n            \"column\": null,\n            \"check_clause\": \"week_end IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17554_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_weeks\",\n            \"column\": null,\n            \"check_clause\": \"open_after_close IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"rota_weeks_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_weeks\",\n            \"column\": null,\n            \"check_clause\": \"(week_end = (week_start + '6 days'::interval))\",\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"week_end\"\n        },\n        {\n            \"name\": \"rota_weeks_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"rota_weeks\",\n            \"column\": null,\n            \"check_clause\": \"(week_end = (week_start + '6 days'::interval))\",\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"week_start\"\n        },\n        {\n            \"name\": \"rota_weeks_period_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_weeks_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"rota_weeks_unique_period_week\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"rota_weeks_unique_period_week\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"week_start\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"week_start\"\n        },\n        {\n            \"name\": \"rota_weeks_unique_period_week\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"week_start\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"rota_weeks_unique_period_week\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"rota_weeks\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"week_start\"\n        },\n        {\n            \"name\": \"2200_17703_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"sessions\",\n            \"column\": null,\n            \"check_clause\": \"token IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17703_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"sessions\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17703_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"sessions\",\n            \"column\": null,\n            \"check_clause\": \"expires_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17703_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"sessions\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"sessions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"sessions\",\n            \"column\": \"token\",\n            \"check_clause\": null,\n            \"foreign_table\": \"sessions\",\n            \"foreign_column\": \"token\"\n        },\n        {\n            \"name\": \"sessions_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"sessions\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_33199_10_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"allow_post_publish IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_11_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"is_active IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_12_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"start_time IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"end_time IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"hours_value IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_7_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"is_night IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"allow_requests IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33199_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_catalogue\",\n            \"column\": null,\n            \"check_clause\": \"allow_draft IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"shift_catalogue_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"shift_catalogue\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shift_catalogue\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_33063_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_eligibility\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33063_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_eligibility\",\n            \"column\": null,\n            \"check_clause\": \"shift_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33063_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_eligibility\",\n            \"column\": null,\n            \"check_clause\": \"staff_grade IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"shift_eligibility_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shift_eligibility\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"shift_eligibility_shift_id_staff_grade_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"staff_grade\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shift_eligibility\",\n            \"foreign_column\": \"staff_grade\"\n        },\n        {\n            \"name\": \"shift_eligibility_shift_id_staff_grade_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"staff_grade\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shift_eligibility\",\n            \"foreign_column\": \"shift_id\"\n        },\n        {\n            \"name\": \"shift_eligibility_shift_id_staff_grade_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"shift_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shift_eligibility\",\n            \"foreign_column\": \"staff_grade\"\n        },\n        {\n            \"name\": \"shift_eligibility_shift_id_staff_grade_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shift_eligibility\",\n            \"column\": \"shift_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shift_eligibility\",\n            \"foreign_column\": \"shift_id\"\n        },\n        {\n            \"name\": \"shift_eligibility_staff_grade_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"shift_eligibility\",\n            \"column\": null,\n            \"check_clause\": \"(staff_grade = ANY (ARRAY['Nursing Assistant'::text, 'Staff Nurse'::text, 'Charge Nurse'::text]))\",\n            \"foreign_table\": \"shift_eligibility\",\n            \"foreign_column\": \"staff_grade\"\n        },\n        {\n            \"name\": \"2200_33130_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shifts\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33130_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shifts\",\n            \"column\": null,\n            \"check_clause\": \"code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33130_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shifts\",\n            \"column\": null,\n            \"check_clause\": \"hours_value IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_33130_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"shifts\",\n            \"column\": null,\n            \"check_clause\": \"allowed_staff_groups IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"code\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"allowed_staff_groups\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"code\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"code\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"code\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"hours_value\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"hours_value\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"allowed_staff_groups\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"hours_value\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"code\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"hours_value\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"hours_value\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"allowed_staff_groups\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"allowed_staff_groups\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"allowed_staff_groups\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"code\"\n        },\n        {\n            \"name\": \"shifts_code_hours_allowed_groups_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"shifts\",\n            \"column\": \"allowed_staff_groups\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"hours_value\"\n        },\n        {\n            \"name\": \"shifts_day_or_night_check\",\n            \"type\": \"CHECK\",\n            \"table\": \"shifts\",\n            \"column\": null,\n            \"check_clause\": \"(day_or_night = ANY (ARRAY['day'::text, 'night'::text]))\",\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"day_or_night\"\n        },\n        {\n            \"name\": \"shifts_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"shifts\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"shifts\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34393_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"staffing_requirements\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34393_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"staffing_requirements\",\n            \"column\": null,\n            \"check_clause\": \"date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"staffing_requirements_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"staffing_requirements\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"staffing_requirements_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"staffing_requirements\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"staffing_requirements_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"staffing_requirements\",\n            \"foreign_column\": \"date\"\n        },\n        {\n            \"name\": \"staffing_requirements_period_id_date_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"date\",\n            \"check_clause\": null,\n            \"foreign_table\": \"staffing_requirements\",\n            \"foreign_column\": \"period_id\"\n        },\n        {\n            \"name\": \"staffing_requirements_period_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"period_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_periods\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"staffing_requirements_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"staffing_requirements\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"staffing_requirements\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34767_10_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_11_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"authoriser_user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_12_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"authoriser_name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_13_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"initiator_old_shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_14_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"initiator_old_shift_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_15_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"initiator_new_shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_16_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"initiator_new_shift_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_17_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_old_shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_18_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_old_shift_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_19_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_new_shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_20_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_new_shift_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"method IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_7_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"initiator_user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"initiator_name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34767_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_executions\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"swap_executions_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"swap_executions\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"swap_executions\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"swap_executions_swap_request_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"swap_executions\",\n            \"column\": \"swap_request_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"swap_requests\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_34735_11_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"status IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"initiator_user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"initiator_shift_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"initiator_shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_shift_date IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_34735_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"counterparty_shift_code IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"initiator_not_counterparty\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"(initiator_user_id <> counterparty_user_id)\",\n            \"foreign_table\": \"swap_requests\",\n            \"foreign_column\": \"initiator_user_id\"\n        },\n        {\n            \"name\": \"initiator_not_counterparty\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"(initiator_user_id <> counterparty_user_id)\",\n            \"foreign_table\": \"swap_requests\",\n            \"foreign_column\": \"counterparty_user_id\"\n        },\n        {\n            \"name\": \"swap_requests_admin_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"swap_requests\",\n            \"column\": \"admin_user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"swap_requests_counterparty_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"swap_requests\",\n            \"column\": \"counterparty_user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"swap_requests_initiator_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"swap_requests\",\n            \"column\": \"initiator_user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"swap_requests_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"swap_requests\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"swap_requests\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"valid_status\",\n            \"type\": \"CHECK\",\n            \"table\": \"swap_requests\",\n            \"column\": null,\n            \"check_clause\": \"(status = ANY (ARRAY['pending'::text, 'accepted_by_counterparty'::text, 'approved_by_admin'::text, 'declined_by_counterparty'::text, 'declined_by_admin'::text, 'ignored'::text, 'executed'::text]))\",\n            \"foreign_table\": \"swap_requests\",\n            \"foreign_column\": \"status\"\n        },\n        {\n            \"name\": \"2200_33175_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"user_patterns\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"user_patterns_assigned_by_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"user_patterns\",\n            \"column\": \"assigned_by\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"user_patterns_pattern_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"user_patterns\",\n            \"column\": \"pattern_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"pattern_definitions\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"user_patterns_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"user_patterns\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"user_patterns\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"user_patterns_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"user_patterns\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_32937_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"user_permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_32937_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"user_permission_groups\",\n            \"column\": null,\n            \"check_clause\": \"group_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"user_permission_groups_group_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"group_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"permission_groups\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"user_permission_groups_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"group_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"user_permission_groups\",\n            \"foreign_column\": \"group_id\"\n        },\n        {\n            \"name\": \"user_permission_groups_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"user_permission_groups\",\n            \"foreign_column\": \"group_id\"\n        },\n        {\n            \"name\": \"user_permission_groups_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"group_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"user_permission_groups\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"user_permission_groups_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"user_permission_groups\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"user_permission_groups_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"user_permission_groups\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_17533_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"users\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17533_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"users\",\n            \"column\": null,\n            \"check_clause\": \"name IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17533_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"users\",\n            \"column\": null,\n            \"check_clause\": \"can_edit IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17533_7_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"users\",\n            \"column\": null,\n            \"check_clause\": \"is_admin IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17533_8_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"users\",\n            \"column\": null,\n            \"check_clause\": \"is_active IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17533_9_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"users\",\n            \"column\": null,\n            \"check_clause\": \"preferred_lang IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"users_name_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"users\",\n            \"column\": \"name\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"name\"\n        },\n        {\n            \"name\": \"users_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"users\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"users_role_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"users\",\n            \"column\": \"role_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"roles\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"2200_17845_1_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"week_comments\",\n            \"column\": null,\n            \"check_clause\": \"id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17845_2_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"week_comments\",\n            \"column\": null,\n            \"check_clause\": \"week_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17845_3_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"week_comments\",\n            \"column\": null,\n            \"check_clause\": \"user_id IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17845_4_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"week_comments\",\n            \"column\": null,\n            \"check_clause\": \"comment IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17845_5_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"week_comments\",\n            \"column\": null,\n            \"check_clause\": \"updated_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"2200_17845_6_not_null\",\n            \"type\": \"CHECK\",\n            \"table\": \"week_comments\",\n            \"column\": null,\n            \"check_clause\": \"created_at IS NOT NULL\",\n            \"foreign_table\": null,\n            \"foreign_column\": null\n        },\n        {\n            \"name\": \"week_comments_pkey\",\n            \"type\": \"PRIMARY KEY\",\n            \"table\": \"week_comments\",\n            \"column\": \"id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"week_comments_user_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"week_comments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"users\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"week_comments_week_id_fkey\",\n            \"type\": \"FOREIGN KEY\",\n            \"table\": \"week_comments\",\n            \"column\": \"week_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"rota_weeks\",\n            \"foreign_column\": \"id\"\n        },\n        {\n            \"name\": \"week_comments_week_id_user_id_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"week_id\"\n        },\n        {\n            \"name\": \"week_comments_week_id_user_id_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"week_comments_week_id_user_id_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"week_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"week_id\"\n        },\n        {\n            \"name\": \"week_comments_week_id_user_id_key\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"week_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"week_comments_week_user_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"week_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"week_comments_week_user_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"week_id\"\n        },\n        {\n            \"name\": \"week_comments_week_user_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"user_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"user_id\"\n        },\n        {\n            \"name\": \"week_comments_week_user_unique\",\n            \"type\": \"UNIQUE\",\n            \"table\": \"week_comments\",\n            \"column\": \"week_id\",\n            \"check_clause\": null,\n            \"foreign_table\": \"week_comments\",\n            \"foreign_column\": \"week_id\"\n        }\n    ],\n    \"rls_policies\": [\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"notice_ack\",\n            \"using\": \"false\",\n            \"policy\": \"ack no direct\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"false\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"notices\",\n            \"using\": \"true\",\n            \"policy\": \"admin can read notices\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"notices\",\n            \"using\": \"false\",\n            \"policy\": \"notices no direct\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"false\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"request_cell_locks\",\n            \"using\": \"true\",\n            \"policy\": \"public read request_cell_locks\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"true\",\n            \"policy\": \"public read requests\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"true\",\n            \"policy\": \"public_read_requests\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"is_admin()\",\n            \"policy\": \"requests_admin_all\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"is_admin()\"\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"false\",\n            \"policy\": \"requests_no_delete\",\n            \"command\": \"DELETE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"requests\",\n            \"using\": null,\n            \"policy\": \"requests_no_insert\",\n            \"command\": \"INSERT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"false\"\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"false\",\n            \"policy\": \"requests_no_update\",\n            \"command\": \"UPDATE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"false\"\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"true\",\n            \"policy\": \"requests_public_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"true\",\n            \"policy\": \"requests_read_all\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"(auth.uid() = user_id)\",\n            \"policy\": \"requests_select_own\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"requests\",\n            \"using\": \"(auth.uid() = user_id)\",\n            \"policy\": \"requests_write_own\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(auth.uid() = user_id)\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"roles\",\n            \"using\": \"true\",\n            \"policy\": \"public read roles\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"roles\",\n            \"using\": \"true\",\n            \"policy\": \"roles_public_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_comments\",\n            \"using\": \"((EXISTS ( SELECT 1\\n   FROM users\\n  WHERE ((users.id = auth.uid()) AND (users.is_admin = true)))) OR (created_by = auth.uid()))\",\n            \"policy\": \"Can delete own comments\",\n            \"command\": \"DELETE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_comments\",\n            \"using\": null,\n            \"policy\": \"Can insert comments\",\n            \"command\": \"INSERT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(auth.uid() IS NOT NULL)\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_comments\",\n            \"using\": \"((EXISTS ( SELECT 1\\n   FROM users\\n  WHERE ((users.id = auth.uid()) AND (users.is_admin = true)))) OR (is_admin_only = false))\",\n            \"policy\": \"Can select own and public comments\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_comments\",\n            \"using\": \"((EXISTS ( SELECT 1\\n   FROM users\\n  WHERE ((users.id = auth.uid()) AND (users.is_admin = true)))) OR (created_by = auth.uid()))\",\n            \"policy\": \"Can update own comments\",\n            \"command\": \"UPDATE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"((EXISTS ( SELECT 1\\n   FROM users\\n  WHERE ((users.id = auth.uid()) AND (users.is_admin = true)))) OR (created_by = auth.uid()))\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_overrides\",\n            \"using\": \"(auth.uid() IS NOT NULL)\",\n            \"policy\": \"Can delete overrides\",\n            \"command\": \"DELETE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_overrides\",\n            \"using\": null,\n            \"policy\": \"Can insert overrides\",\n            \"command\": \"INSERT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(auth.uid() IS NOT NULL)\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_overrides\",\n            \"using\": \"(auth.uid() IS NOT NULL)\",\n            \"policy\": \"Can select overrides\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_assignment_overrides\",\n            \"using\": \"(auth.uid() IS NOT NULL)\",\n            \"policy\": \"Can update overrides\",\n            \"command\": \"UPDATE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(auth.uid() IS NOT NULL)\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_dates\",\n            \"using\": \"true\",\n            \"policy\": \"public read rota_dates\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_dates\",\n            \"using\": \"true\",\n            \"policy\": \"public_read_rota_dates\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"rota_dates\",\n            \"using\": \"true\",\n            \"policy\": \"rota_dates_public_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"rota_dates\",\n            \"using\": \"true\",\n            \"policy\": \"rota_dates_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_periods\",\n            \"using\": \"true\",\n            \"policy\": \"public read rota_periods\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_periods\",\n            \"using\": \"true\",\n            \"policy\": \"public_read_rota_periods\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"rota_periods\",\n            \"using\": \"true\",\n            \"policy\": \"rota_periods_public_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"rota_periods\",\n            \"using\": \"true\",\n            \"policy\": \"rota_periods_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_weeks\",\n            \"using\": \"true\",\n            \"policy\": \"public read rota_weeks\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"rota_weeks\",\n            \"using\": \"true\",\n            \"policy\": \"public_read_rota_weeks\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"rota_weeks\",\n            \"using\": \"true\",\n            \"policy\": \"rota_weeks_public_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"rota_weeks\",\n            \"using\": \"true\",\n            \"policy\": \"rota_weeks_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"authenticated\"\n            ],\n            \"table\": \"staffing_requirements\",\n            \"using\": \"true\",\n            \"policy\": \"Anyone can read staffing requirements\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"authenticated\"\n            ],\n            \"table\": \"staffing_requirements\",\n            \"using\": \"(EXISTS ( SELECT 1\\n   FROM users\\n  WHERE ((users.id = auth.uid()) AND (users.is_admin = true))))\",\n            \"policy\": \"Only admins can modify staffing requirements\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(EXISTS ( SELECT 1\\n   FROM users\\n  WHERE ((users.id = auth.uid()) AND (users.is_admin = true))))\"\n        },\n        {\n            \"roles\": [\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"true\",\n            \"policy\": \"Allow FK validation for swap functions\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"(auth.uid() IS NOT NULL)\",\n            \"policy\": \"Allow admins to update display_order only\",\n            \"command\": \"UPDATE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(auth.uid() IS NOT NULL)\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"is_admin()\",\n            \"policy\": \"admins_select_all\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"true\",\n            \"policy\": \"public can read users\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"(is_active = true)\",\n            \"policy\": \"read users\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"(EXISTS ( SELECT 1\\n   FROM users u\\n  WHERE ((u.id = auth.uid()) AND (u.is_admin = true))))\",\n            \"policy\": \"users_admin_delete\",\n            \"command\": \"DELETE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": null,\n            \"policy\": \"users_admin_insert\",\n            \"command\": \"INSERT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(EXISTS ( SELECT 1\\n   FROM users u\\n  WHERE ((u.id = auth.uid()) AND (u.is_admin = true))))\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"(EXISTS ( SELECT 1\\n   FROM users u\\n  WHERE ((u.id = auth.uid()) AND (u.is_admin = true))))\",\n            \"policy\": \"users_admin_update\",\n            \"command\": \"UPDATE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(EXISTS ( SELECT 1\\n   FROM users u\\n  WHERE ((u.id = auth.uid()) AND (u.is_admin = true))))\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"false\",\n            \"policy\": \"users_deny_delete\",\n            \"command\": \"DELETE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": null,\n            \"policy\": \"users_deny_insert\",\n            \"command\": \"INSERT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"false\"\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"false\",\n            \"policy\": \"users_no_delete\",\n            \"command\": \"DELETE\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": null,\n            \"policy\": \"users_no_insert\",\n            \"command\": \"INSERT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"false\"\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"true\",\n            \"policy\": \"users_public_read\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"(is_active IS DISTINCT FROM false)\",\n            \"policy\": \"users_read_active\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"true\",\n            \"policy\": \"users_select_all\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"anon\",\n                \"authenticated\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"true\",\n            \"policy\": \"users_select_public\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"users\",\n            \"using\": \"(auth.uid() = id)\",\n            \"policy\": \"users_select_self\",\n            \"command\": \"SELECT\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": null\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"week_comments\",\n            \"using\": \"is_admin()\",\n            \"policy\": \"week_comments_admin_all\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"is_admin()\"\n        },\n        {\n            \"roles\": [\n                \"public\"\n            ],\n            \"table\": \"week_comments\",\n            \"using\": \"(auth.uid() = user_id)\",\n            \"policy\": \"week_comments_own\",\n            \"command\": \"ALL\",\n            \"permissive\": \"PERMISSIVE\",\n            \"with_check\": \"(auth.uid() = user_id)\"\n        }\n    ]\n}"
  }
]
